/*

 // Underscore.js 1.1.7
 // (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.
 // Underscore is freely distributable under the MIT license.
 // Portions of Underscore are inspired or borrowed from Prototype,
 // Oliver Steele's Functional, and John Resig's Micro-Templating.
 // For all details and documentation:
 // http://documentcloud.github.com/underscore
*/
(function(){var t=this,D=t._,z={},q=Array.prototype,E=Object.prototype,F=q.slice,x=q.unshift,n=E.toString,v=E.hasOwnProperty,f=q.forEach,y=q.map,g=q.reduce,p=q.reduceRight,u=q.filter,w=q.every,H=q.some,d=q.indexOf,m=q.lastIndexOf;E=Array.isArray;var o=Object.keys,b=Function.prototype.bind,a=function(c){return new s(c)};typeof module!=="undefined"&&module.exports?(module.exports=a,a._=a):t._=a;a.VERSION="1.1.7";var j=a.each=a.forEach=function(c,k,l){if(c!=null)if(f&&c.forEach===f)c.forEach(k,l);else if(c.length===
+c.length)for(var A=0,C=c.length;A<C;A++){if(A in c&&k.call(l,c[A],A,c)===z)break}else for(A in c)if(v.call(c,A)&&k.call(l,c[A],A,c)===z)break};a.map=function(c,k,l){var A=[];if(c==null)return A;if(y&&c.map===y)return c.map(k,l);j(c,function(C,G,J){A[A.length]=k.call(l,C,G,J)});return A};a.reduce=a.foldl=a.inject=function(c,k,l,A){var C=l!==void 0;c==null&&(c=[]);if(g&&c.reduce===g)return A&&(k=a.bind(k,A)),C?c.reduce(k,l):c.reduce(k);j(c,function(G,J,K){C?l=k.call(A,l,G,J,K):(l=G,C=true)});if(!C)throw new TypeError("Reduce of empty array with no initial value");
return l};a.reduceRight=a.foldr=function(c,k,l,A){c==null&&(c=[]);if(p&&c.reduceRight===p)return A&&(k=a.bind(k,A)),l!==void 0?c.reduceRight(k,l):c.reduceRight(k);c=(a.isArray(c)?c.slice():a.toArray(c)).reverse();return a.reduce(c,k,l,A)};a.find=a.detect=function(c,k,l){var A;e(c,function(C,G,J){if(k.call(l,C,G,J))return A=C,true});return A};a.filter=a.select=function(c,k,l){var A=[];if(c==null)return A;if(u&&c.filter===u)return c.filter(k,l);j(c,function(C,G,J){k.call(l,C,G,J)&&(A[A.length]=C)});
return A};a.reject=function(c,k,l){var A=[];if(c==null)return A;j(c,function(C,G,J){k.call(l,C,G,J)||(A[A.length]=C)});return A};a.every=a.all=function(c,k,l){var A=true;if(c==null)return A;if(w&&c.every===w)return c.every(k,l);j(c,function(C,G,J){if(!(A=A&&k.call(l,C,G,J)))return z});return A};var e=a.some=a.any=function(c,k,l){k=k||a.identity;var A=false;if(c==null)return A;if(H&&c.some===H)return c.some(k,l);j(c,function(C,G,J){if(A|=k.call(l,C,G,J))return z});return!!A};a.include=a.contains=function(c,
k){var l=false;if(c==null)return l;if(d&&c.indexOf===d)return c.indexOf(k)!=-1;e(c,function(A){if(l=A===k)return true});return l};a.invoke=function(c,k){var l=F.call(arguments,2);return a.map(c,function(A){return(k.call?k||A:A[k]).apply(A,l)})};a.pluck=function(c,k){return a.map(c,function(l){return l[k]})};a.max=function(c,k,l){if(!k&&a.isArray(c))return Math.max.apply(Math,c);var A={computed:-Infinity};j(c,function(C,G,J){G=k?k.call(l,C,G,J):C;G>=A.computed&&(A={value:C,computed:G})});return A.value};
a.min=function(c,k,l){if(!k&&a.isArray(c))return Math.min.apply(Math,c);var A={computed:Infinity};j(c,function(C,G,J){G=k?k.call(l,C,G,J):C;G<A.computed&&(A={value:C,computed:G})});return A.value};a.sortBy=function(c,k,l){return a.pluck(a.map(c,function(A,C,G){return{value:A,criteria:k.call(l,A,C,G)}}).sort(function(A,C){var G=A.criteria,J=C.criteria;return G<J?-1:G>J?1:0}),"value")};a.groupBy=function(c,k){var l={};j(c,function(A,C){var G=k(A,C);(l[G]||(l[G]=[])).push(A)});return l};a.sortedIndex=
function(c,k,l){l||(l=a.identity);for(var A=0,C=c.length;A<C;){var G=A+C>>1;l(c[G])<l(k)?A=G+1:C=G}return A};a.toArray=function(c){if(!c)return[];if(c.toArray)return c.toArray();if(a.isArray(c))return F.call(c);if(a.isArguments(c))return F.call(c);return a.values(c)};a.size=function(c){return a.toArray(c).length};a.first=a.head=function(c,k,l){return k!=null&&!l?F.call(c,0,k):c[0]};a.rest=a.tail=function(c,k,l){return F.call(c,k==null||l?1:k)};a.last=function(c){return c[c.length-1]};a.compact=function(c){return a.filter(c,
function(k){return!!k})};a.flatten=function(c){return a.reduce(c,function(k,l){if(a.isArray(l))return k.concat(a.flatten(l));k[k.length]=l;return k},[])};a.without=function(c){return a.difference(c,F.call(arguments,1))};a.uniq=a.unique=function(c,k){return a.reduce(c,function(l,A,C){if(0==C||(k===true?a.last(l)!=A:!a.include(l,A)))l[l.length]=A;return l},[])};a.union=function(){return a.uniq(a.flatten(arguments))};a.intersection=a.intersect=function(c){var k=F.call(arguments,1);return a.filter(a.uniq(c),
function(l){return a.every(k,function(A){return a.indexOf(A,l)>=0})})};a.difference=function(c,k){return a.filter(c,function(l){return!a.include(k,l)})};a.zip=function(){for(var c=F.call(arguments),k=a.max(a.pluck(c,"length")),l=Array(k),A=0;A<k;A++)l[A]=a.pluck(c,""+A);return l};a.indexOf=function(c,k,l){if(c==null)return-1;var A;if(l)return l=a.sortedIndex(c,k),c[l]===k?l:-1;if(d&&c.indexOf===d)return c.indexOf(k);l=0;for(A=c.length;l<A;l++)if(c[l]===k)return l;return-1};a.lastIndexOf=function(c,
k){if(c==null)return-1;if(m&&c.lastIndexOf===m)return c.lastIndexOf(k);for(var l=c.length;l--;)if(c[l]===k)return l;return-1};a.range=function(c,k,l){arguments.length<=1&&(k=c||0,c=0);l=arguments[2]||1;for(var A=Math.max(Math.ceil((k-c)/l),0),C=0,G=Array(A);C<A;){G[C++]=c;c+=l}return G};a.bind=function(c,k){if(c.bind===b&&b)return b.apply(c,F.call(arguments,1));var l=F.call(arguments,2);return function(){return c.apply(k,l.concat(F.call(arguments)))}};a.bindAll=function(c){var k=F.call(arguments,
1);k.length==0&&(k=a.functions(c));j(k,function(l){c[l]=a.bind(c[l],c)});return c};a.memoize=function(c,k){var l={};k||(k=a.identity);return function(){var A=k.apply(this,arguments);return v.call(l,A)?l[A]:l[A]=c.apply(this,arguments)}};a.delay=function(c,k){var l=F.call(arguments,2);return setTimeout(function(){return c.apply(c,l)},k)};a.defer=function(c){return a.delay.apply(a,[c,1].concat(F.call(arguments,1)))};var i=function(c,k,l){var A;return function(){var C=this,G=arguments,J=function(){A=
null;c.apply(C,G)};l&&clearTimeout(A);if(l||!A)A=setTimeout(J,k)}};a.throttle=function(c,k){return i(c,k,false)};a.debounce=function(c,k){return i(c,k,true)};a.once=function(c){var k=false,l;return function(){if(k)return l;k=true;return l=c.apply(this,arguments)}};a.wrap=function(c,k){return function(){var l=[c].concat(F.call(arguments));return k.apply(this,l)}};a.compose=function(){var c=F.call(arguments);return function(){for(var k=F.call(arguments),l=c.length-1;l>=0;l--)k=[c[l].apply(this,k)];
return k[0]}};a.after=function(c,k){return function(){if(--c<1)return k.apply(this,arguments)}};a.keys=o||function(c){if(c!==Object(c))throw new TypeError("Invalid object");var k=[],l;for(l in c)v.call(c,l)&&(k[k.length]=l);return k};a.values=function(c){return a.map(c,a.identity)};a.functions=a.methods=function(c){var k=[],l;for(l in c)a.isFunction(c[l])&&k.push(l);return k.sort()};a.extend=function(c){j(F.call(arguments,1),function(k){for(var l in k)k[l]!==void 0&&(c[l]=k[l])});return c};a.defaults=
function(c){j(F.call(arguments,1),function(k){for(var l in k)c[l]==null&&(c[l]=k[l])});return c};a.clone=function(c){return a.isArray(c)?c.slice():a.extend({},c)};a.tap=function(c,k){k(c);return c};a.isEqual=function(c,k){if(c===k)return true;var l=typeof c;if(l!=typeof k)return false;if(c==k)return true;if(!c&&k||c&&!k)return false;if(c._chain)c=c._wrapped;if(k._chain)k=k._wrapped;if(c.isEqual)return c.isEqual(k);if(k.isEqual)return k.isEqual(c);if(a.isDate(c)&&a.isDate(k))return c.getTime()===k.getTime();
if(a.isNaN(c)&&a.isNaN(k))return false;if(a.isRegExp(c)&&a.isRegExp(k))return c.source===k.source&&c.global===k.global&&c.ignoreCase===k.ignoreCase&&c.multiline===k.multiline;if(l!=="object")return false;if(c.length&&c.length!==k.length)return false;l=a.keys(c);var A=a.keys(k);if(l.length!=A.length)return false;for(var C in c)if(!(C in k)||!a.isEqual(c[C],k[C]))return false;return true};a.isEmpty=function(c){if(a.isArray(c)||a.isString(c))return c.length===0;for(var k in c)if(v.call(c,k))return false;
return true};a.isElement=function(c){return!!(c&&c.nodeType==1)};a.isArray=E||function(c){return n.call(c)==="[object Array]"};a.isObject=function(c){return c===Object(c)};a.isArguments=function(c){return!(!c||!v.call(c,"callee"))};a.isFunction=function(c){return!(!c||!c.constructor||!c.call||!c.apply)};a.isString=function(c){return!!(c===""||c&&c.charCodeAt&&c.substr)};a.isNumber=function(c){return!!(c===0||c&&c.toExponential&&c.toFixed)};a.isNaN=function(c){return c!==c};a.isBoolean=function(c){return c===
true||c===false};a.isDate=function(c){return!(!c||!c.getTimezoneOffset||!c.setUTCFullYear)};a.isRegExp=function(c){return!(!c||!c.test||!c.exec||!(c.ignoreCase||c.ignoreCase===false))};a.isNull=function(c){return c===null};a.isUndefined=function(c){return c===void 0};a.noConflict=function(){t._=D;return this};a.identity=function(c){return c};a.times=function(c,k,l){for(var A=0;A<c;A++)k.call(l,A)};a.mixin=function(c){j(a.functions(c),function(k){B(k,a[k]=c[k])})};var h=0;a.uniqueId=function(c){var k=
h++;return c?c+k:k};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};a.template=function(c,k){var l=a.templateSettings;l="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+c.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(l.interpolate,function(A,C){return"',"+C.replace(/\\'/g,"'")+",'"}).replace(l.evaluate||null,function(A,C){return"');"+C.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,
"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";l=new Function("obj",l);return k?l(k):l};var s=function(c){this._wrapped=c};a.prototype=s.prototype;var r=function(c,k){return k?a(c).chain():c},B=function(c,k){s.prototype[c]=function(){var l=F.call(arguments);x.call(l,this._wrapped);return r(k.apply(a,l),this._chain)}};a.mixin(a);j(["pop","push","reverse","shift","sort","splice","unshift"],function(c){var k=q[c];s.prototype[c]=function(){k.apply(this._wrapped,arguments);return r(this._wrapped,
this._chain)}});j(["concat","join","slice"],function(c){var k=q[c];s.prototype[c]=function(){return r(k.apply(this._wrapped,arguments),this._chain)}});s.prototype.chain=function(){this._chain=true;return this};s.prototype.value=function(){return this._wrapped}})();/*

 // Backbone.js 0.5.3
 // (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
 // Backbone may be freely distributed under the MIT license.
 // For all details and documentation:
 // http://documentcloud.github.com/backbone
*/
(function(){var t=this,D=t.Backbone,z;z=typeof exports!=="undefined"?exports:t.Backbone={};z.VERSION="0.5.3";var q=t._;if(!q&&typeof require!=="undefined")q=require("underscore")._;var E=t.jQuery||t.Zepto;z.noConflict=function(){t.Backbone=D;return this};z.emulateHTTP=false;z.emulateJSON=false;z.Events={bind:function(b,a,j){var e=this._callbacks||(this._callbacks={});(e[b]||(e[b]=[])).push([a,j]);return this},unbind:function(b,a){var j;if(b){if(j=this._callbacks)if(a){j=j[b];if(!j)return this;for(var e=
0,i=j.length;e<i;e++)if(j[e]&&a===j[e][0]){j[e]=null;break}}else j[b]=[]}else this._callbacks={};return this},trigger:function(b){var a,j,e,i,h=2;if(!(j=this._callbacks))return this;for(;h--;)if(a=h?b:"all",a=j[a])for(var s=0,r=a.length;s<r;s++)(e=a[s])?(i=h?Array.prototype.slice.call(arguments,1):arguments,e[0].apply(e[1]||this,i)):(a.splice(s,1),s--,r--);return this}};z.Model=function(b,a){var j;b||(b={});if(j=this.defaults){q.isFunction(j)&&(j=j.call(this));b=q.extend({},j,b)}this.attributes={};
this._escapedAttributes={};this.cid=q.uniqueId("c");this.set(b,{silent:true});this._changed=false;this._previousAttributes=q.clone(this.attributes);if(a&&a.collection)this.collection=a.collection;this.initialize(b,a)};q.extend(z.Model.prototype,z.Events,{_previousAttributes:null,_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return q.clone(this.attributes)},get:function(b){return this.attributes[b]},escape:function(b){var a;if(a=this._escapedAttributes[b])return a;a=this.attributes[b];
return this._escapedAttributes[b]=(a==null?"":""+a).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(b){return this.attributes[b]!=null},set:function(b,a){a||(a={});if(!b)return this;if(b.attributes)b=b.attributes;var j=this.attributes,e=this._escapedAttributes;if(!a.silent&&this.validate&&!this._performValidation(b,a))return false;if(this.idAttribute in b)this.id=b[this.idAttribute];
var i=this._changing;this._changing=true;for(var h in b){var s=b[h];if(!q.isEqual(j[h],s)){j[h]=s;delete e[h];this._changed=true;a.silent||this.trigger("change:"+h,this,s,a)}}!i&&!a.silent&&this._changed&&this.change(a);this._changing=false;return this},unset:function(b,a){if(!(b in this.attributes))return this;a||(a={});var j={};j[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(j,a))return false;delete this.attributes[b];delete this._escapedAttributes[b];b==this.idAttribute&&delete this.id;
this._changed=true;a.silent||(this.trigger("change:"+b,this,void 0,a),this.change(a));return this},clear:function(b){b||(b={});var a,j=this.attributes,e={};for(a in j)e[a]=void 0;if(!b.silent&&this.validate&&!this._performValidation(e,b))return false;this.attributes={};this._escapedAttributes={};this._changed=true;if(!b.silent){for(a in j)this.trigger("change:"+a,this,void 0,b);this.change(b)}return this},fetch:function(b){b||(b={});var a=this,j=b.success;b.success=function(e,i,h){if(!a.set(a.parse(e,
h),b))return false;j&&j(a,e)};b.error=o(b.error,a,b);return(this.sync||z.sync).call(this,"read",this,b)},save:function(b,a){a||(a={});if(b&&!this.set(b,a))return false;var j=this,e=a.success;a.success=function(h,s,r){if(!j.set(j.parse(h,r),a))return false;e&&e(j,h,r)};a.error=o(a.error,j,a);var i=this.isNew()?"create":"update";return(this.sync||z.sync).call(this,i,this,a)},destroy:function(b){b||(b={});if(this.isNew())return this.trigger("destroy",this,this.collection,b);var a=this,j=b.success;b.success=
function(e){a.trigger("destroy",a,a.collection,b);j&&j(a,e)};b.error=o(b.error,a,b);return(this.sync||z.sync).call(this,"delete",this,b)},url:function(){var b=d(this.collection)||this.urlRoot||m();if(this.isNew())return b;return b+(b.charAt(b.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(b){return b},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(b){this.trigger("change",this,b);this._previousAttributes=q.clone(this.attributes);
this._changed=false},hasChanged:function(b){if(b)return this._previousAttributes[b]!=this.attributes[b];return this._changed},changedAttributes:function(b){b||(b=this.attributes);var a=this._previousAttributes,j=false,e;for(e in b)q.isEqual(a[e],b[e])||(j=j||{},j[e]=b[e]);return j},previous:function(b){if(!b||!this._previousAttributes)return null;return this._previousAttributes[b]},previousAttributes:function(){return q.clone(this._previousAttributes)},_performValidation:function(b,a){var j=this.validate(b);
if(j)return a.error?a.error(this,j,a):this.trigger("error",this,j,a),false;return true}});z.Collection=function(b,a){a||(a={});if(a.comparator)this.comparator=a.comparator;q.bindAll(this,"_onModelEvent","_removeReference");this._reset();b&&this.reset(b,{silent:true});this.initialize.apply(this,arguments)};q.extend(z.Collection.prototype,z.Events,{model:z.Model,initialize:function(){},toJSON:function(){return this.map(function(b){return b.toJSON()})},add:function(b,a){if(q.isArray(b))for(var j=0,e=
b.length;j<e;j++)this._add(b[j],a);else this._add(b,a);return this},remove:function(b,a){if(q.isArray(b))for(var j=0,e=b.length;j<e;j++)this._remove(b[j],a);else this._remove(b,a);return this},get:function(b){if(b==null)return null;return this._byId[b.id!=null?b.id:b]},getByCid:function(b){return b&&this._byCid[b.cid||b]},at:function(b){return this.models[b]},sort:function(b){b||(b={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);
b.silent||this.trigger("reset",this,b);return this},pluck:function(b){return q.map(this.models,function(a){return a.get(b)})},reset:function(b,a){b||(b=[]);a||(a={});this.each(this._removeReference);this._reset();this.add(b,{silent:true});a.silent||this.trigger("reset",this,a);return this},fetch:function(b){b||(b={});var a=this,j=b.success;b.success=function(e,i,h){a[b.add?"add":"reset"](a.parse(e,h),b);j&&j(a,e)};b.error=o(b.error,a,b);return(this.sync||z.sync).call(this,"read",this,b)},create:function(b,
a){var j=this;a||(a={});b=this._prepareModel(b,a);if(!b)return false;var e=a.success;a.success=function(i,h,s){j.add(i,a);e&&e(i,h,s)};b.save(null,a);return b},parse:function(b){return b},chain:function(){return q(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(b,a){if(b instanceof z.Model){if(!b.collection)b.collection=this}else{var j=b;b=new this.model(j,{collection:this});b.validate&&!b._performValidation(j,a)&&(b=false)}return b},
_add:function(b,a){a||(a={});b=this._prepareModel(b,a);if(!b)return false;var j=this.getByCid(b);if(j)throw Error(["Can't add the same model to a set twice",j.id]);this._byId[b.id]=b;this._byCid[b.cid]=b;this.models.splice(a.at!=null?a.at:this.comparator?this.sortedIndex(b,this.comparator):this.length,0,b);b.bind("all",this._onModelEvent);this.length++;a.silent||b.trigger("add",b,this,a);return b},_remove:function(b,a){a||(a={});b=this.getByCid(b)||this.get(b);if(!b)return null;delete this._byId[b.id];
delete this._byCid[b.cid];this.models.splice(this.indexOf(b),1);this.length--;a.silent||b.trigger("remove",b,this,a);this._removeReference(b);return b},_removeReference:function(b){this==b.collection&&delete b.collection;b.unbind("all",this._onModelEvent)},_onModelEvent:function(b,a,j,e){(b=="add"||b=="remove")&&j!=this||(b=="destroy"&&this._remove(a,e),a&&b==="change:"+a.idAttribute&&(delete this._byId[a.previous(a.idAttribute)],this._byId[a.id]=a),this.trigger.apply(this,arguments))}});q.each(["forEach",
"each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"],function(b){z.Collection.prototype[b]=function(){return q[b].apply(q,[this.models].concat(q.toArray(arguments)))}});z.Router=function(b){b||(b={});if(b.routes)this.routes=b.routes;this._bindRoutes();this.initialize.apply(this,arguments)};
var F=/:([\w\d]+)/g,x=/\*([\w\d]+)/g,n=/[-[\]{}()+?.,\\^$|#\s]/g;q.extend(z.Router.prototype,z.Events,{initialize:function(){},route:function(b,a,j){z.history||(z.history=new z.History);q.isRegExp(b)||(b=this._routeToRegExp(b));z.history.route(b,q.bind(function(e){e=this._extractParameters(b,e);j.apply(this,e);this.trigger.apply(this,["route:"+a].concat(e))},this))},navigate:function(b,a){z.history.navigate(b,a)},_bindRoutes:function(){if(this.routes){var b=[],a;for(a in this.routes)b.unshift([a,
this.routes[a]]);a=0;for(var j=b.length;a<j;a++)this.route(b[a][0],b[a][1],this[b[a][1]])}},_routeToRegExp:function(b){b=b.replace(n,"\\$&").replace(F,"([^/]*)").replace(x,"(.*?)");return RegExp("^"+b+"$")},_extractParameters:function(b,a){return b.exec(a).slice(1)}});z.History=function(){this.handlers=[];q.bindAll(this,"checkUrl")};var v=/^#*/,f=/msie [\w.]+/,y=false;q.extend(z.History.prototype,{interval:50,getFragment:function(b,a){if(b==null)if(this._hasPushState||a){b=window.location.pathname;
var j=window.location.search;j&&(b+=j);b.indexOf(this.options.root)==0&&(b=b.substr(this.options.root.length))}else b=window.location.hash;return decodeURIComponent(b.replace(v,""))},start:function(b){if(y)throw Error("Backbone.history has already been started");this.options=q.extend({},{root:"/"},this.options,b);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);b=this.getFragment();var a=document.documentMode;if(a=
f.exec(navigator.userAgent.toLowerCase())&&(!a||a<=7)){this.iframe=E('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(b)}this._hasPushState?E(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!a?E(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=b;y=true;b=window.location;a=b.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!a)return this.fragment=this.getFragment(null,
true),window.location.replace(this.options.root+"#"+this.fragment),true;else if(this._wantsPushState&&this._hasPushState&&a&&b.hash){this.fragment=b.hash.replace(v,"");window.history.replaceState({},document.title,b.protocol+"//"+b.host+this.options.root+this.fragment)}if(!this.options.silent)return this.loadUrl()},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.iframe.location.hash));
if(b==this.fragment||b==decodeURIComponent(this.fragment))return false;this.iframe&&this.navigate(b);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(b){var a=this.fragment=this.getFragment(b);return q.any(this.handlers,function(j){if(j.route.test(a))return j.callback(a),true})},navigate:function(b,a){var j=(b||"").replace(v,"");if(!(this.fragment==j||this.fragment==decodeURIComponent(j))){if(this._hasPushState){var e=window.location;j.indexOf(this.options.root)!=0&&(j=this.options.root+
j);this.fragment=j;window.history.pushState({},document.title,e.protocol+"//"+e.host+j)}else if(window.location.hash=this.fragment=j,this.iframe&&j!=this.getFragment(this.iframe.location.hash)){this.iframe.document.open().close();this.iframe.location.hash=j}a&&this.loadUrl(b)}}});z.View=function(b){this.cid=q.uniqueId("view");this._configure(b||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var g=/^(\S+)\s*(.*)$/,p=["model","collection","el","id","attributes",
"className","tagName"];q.extend(z.View.prototype,z.Events,{tagName:"div",$:function(b){return E(b,this.el)},initialize:function(){},render:function(){return this},remove:function(){E(this.el).remove();return this},make:function(b,a,j){b=document.createElement(b);a&&E(b).attr(a);j&&E(b).html(j);return b},delegateEvents:function(b){if(b||(b=this.events))for(var a in q.isFunction(b)&&(b=b.call(this)),E(this.el).unbind(".delegateEvents"+this.cid),b){var j=this[b[a]];if(!j)throw Error('Event "'+b[a]+'" does not exist');
var e=a.match(g),i=e[1];e=e[2];j=q.bind(j,this);i+=".delegateEvents"+this.cid;e===""?E(this.el).bind(i,j):E(this.el).delegate(e,i,j)}},_configure:function(b){this.options&&(b=q.extend({},this.options,b));for(var a=0,j=p.length;a<j;a++){var e=p[a];b[e]&&(this[e]=b[e])}this.options=b},_ensureElement:function(){if(this.el){if(q.isString(this.el))this.el=E(this.el).get(0)}else{var b=this.attributes||{};if(this.id)b.id=this.id;if(this.className)b["class"]=this.className;this.el=this.make(this.tagName,
b)}}});z.Model.extend=z.Collection.extend=z.Router.extend=z.View.extend=function(b,a){var j=H(this,b,a);j.extend=this.extend;return j};var u={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};z.sync=function(b,a,j){var e=u[b];j=q.extend({type:e,dataType:"json"},j);if(!j.url)j.url=d(a)||m();if(!j.data&&a&&(b=="create"||b=="update")){j.contentType="application/json";j.data=JSON.stringify(a.toJSON())}if(z.emulateJSON){j.contentType="application/x-www-form-urlencoded";j.data=j.data?{model:j.data}:
{}}if(z.emulateHTTP&&(e==="PUT"||e==="DELETE")){if(z.emulateJSON)j.data._method=e;j.type="POST";j.beforeSend=function(i){i.setRequestHeader("X-HTTP-Method-Override",e)}}if(j.type!=="GET"&&!z.emulateJSON)j.processData=false;return E.ajax(j)};var w=function(){},H=function(b,a,j){var e;e=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return b.apply(this,arguments)};q.extend(e,b);w.prototype=b.prototype;e.prototype=new w;a&&q.extend(e.prototype,a);j&&q.extend(e,j);e.prototype.constructor=
e;e.__super__=b.prototype;return e},d=function(b){if(!b||!b.url)return null;return q.isFunction(b.url)?b.url():b.url},m=function(){throw Error('A "url" property or function must be specified');},o=function(b,a,j){return function(e){b?b(a,e,j):a.trigger("error",a,e,j)}}}).call(this);/*

 jQuery Templates Plugin 1.0.0pre
 http://github.com/jquery/jquery-tmpl
 Requires jQuery 1.4.2

 Copyright Software Freedom Conservancy, Inc.
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(t){function D(i,h,s,r){r={data:r||r===0||r===false?r:h?h.data:{},_wrap:h?h._wrap:null,tmpl:null,parent:h||null,nodes:[],calls:v,nest:f,wrap:y,html:g,update:p};i&&t.extend(r,i,{nodes:[],parent:h});if(s){r.tmpl=s;r._ctnt=r._ctnt||r.tmpl(t,r);r.key=++a;(e.length?m:d)[a]=r}return r}function z(i,h,s){var r;s=s?t.map(s,function(B){return typeof B==="string"?i.key?B.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+w+'="'+i.key+'" $2'):B:z(B,i,B._ctnt)}):i;if(h)return s;s=s.join("");s.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(B,c,k,l){r=t(k).get();n(r);if(c)r=q(c).concat(r);if(l)r=r.concat(q(l))});return r?r:q(s)}function q(i){var h=document.createElement("div");h.innerHTML=i;return t.makeArray(h.childNodes)}function E(i){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+t.trim(i).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(h,s,r,B,c,k,l){h=t.tmpl.tag[r];if(!h)throw"Unknown template tag: "+r;r=h._default||[];if(k&&!/\w$/.test(c)){c+=k;k=""}if(c){c=x(c);l=l?","+x(l)+")":k?")":"";l=k?c.indexOf(".")>-1?c+x(k):"("+c+").call($item"+l:c;k=k?l:"(typeof("+c+")==='function'?("+c+").call($item):("+c+"))"}else k=l=r.$1||"null";B=x(B);return"');"+h[s?"close":"open"].split("$notnull_1").join(c?"typeof("+c+")!=='undefined' && ("+c+")!=null":"true").split("$1a").join(k).split("$1").join(l).split("$2").join(B||r.$2||"")+"__.push('"})+
"');}return __;")}function F(i,h){i._wrap=z(i,true,t.isArray(h)?h:[H.test(h)?h:t(h).html()]).join("")}function x(i){return i?i.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function n(i){function h(C){function G(N){N+=s;I=c[N]=c[N]||D(I,d[I.parent.key+s]||I.parent)}var J,K=C,I,O;if(O=C.getAttribute(w)){for(;K.parentNode&&(K=K.parentNode).nodeType===1&&!(J=K.getAttribute(w)););if(J!==O){K=K.parentNode?K.nodeType===11?0:K.getAttribute(w)||0:0;if(!(I=d[O])){I=m[O];I=D(I,d[K]||m[K]);I.key=++a;d[a]=I}j&&
G(O)}C.removeAttribute(w)}else if(j&&(I=t.data(C,"tmplItem"))){G(I.key);d[I.key]=I;K=(K=t.data(C.parentNode,"tmplItem"))?K.key:0}if(I){for(J=I;J&&J.key!=K;){J.nodes.push(C);J=J.parent}delete I._ctnt;delete I._wrap;t.data(C,"tmplItem",I)}}var s="_"+j,r,B,c={},k,l,A;k=0;for(l=i.length;k<l;k++)if((r=i[k]).nodeType===1){B=r.getElementsByTagName("*");for(A=B.length-1;A>=0;A--)h(B[A]);h(r)}}function v(i,h,s,r){if(!i)return e.pop();e.push({_:i,tmpl:h,item:this,data:s,options:r})}function f(i,h,s){return t.tmpl(t.template(i),
h,s,this)}function y(i,h){var s=i.options||{};s.wrapped=h;return t.tmpl(t.template(i.tmpl),i.data,s,i.item)}function g(i,h){var s=this._wrap;return t.map(t(t.isArray(s)?s.join(""):s).filter(i||"*"),function(r){if(h)r=r.innerText||r.textContent;else{var B;if(!(B=r.outerHTML)){B=document.createElement("div");B.appendChild(r.cloneNode(true));B=B.innerHTML}r=B}return r})}function p(){var i=this.nodes;t.tmpl(null,null,null,this).insertBefore(i[0]);t(i).remove()}var u=t.fn.domManip,w="_tmplitem",H=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
d={},m={},o,b={key:0,data:{}},a=0,j=0,e=[];t.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(i,h){t.fn[i]=function(s){var r=[];s=t(s);var B,c,k;B=this.length===1&&this[0].parentNode;o=d||{};if(B&&B.nodeType===11&&B.childNodes.length===1&&s.length===1){s[h](this[0]);r=this}else{c=0;for(k=s.length;c<k;c++){j=c;B=(c>0?this.clone(true):this).get();t(s[c])[h](B);r=r.concat(B)}j=0;r=this.pushStack(r,i,s.selector)}s=o;o=null;t.tmpl.complete(s);
return r}});t.fn.extend({tmpl:function(i,h,s){return t.tmpl(this[0],i,h,s)},tmplItem:function(){return t.tmplItem(this[0])},template:function(i){return t.template(i,this[0])},domManip:function(i,h,s){if(i[0]&&t.isArray(i[0])){for(var r=t.makeArray(arguments),B=i[0],c=B.length,k=0,l;k<c&&!(l=t.data(B[k++],"tmplItem")););if(l&&j)r[2]=function(A){t.tmpl.afterManip(this,A,s)};u.apply(this,r)}else u.apply(this,arguments);j=0;o||t.tmpl.complete(d);return this}});t.extend({tmpl:function(i,h,s,r){var B=!r;
if(B){r=b;i=t.template[i]||t.template(null,i);m={}}else if(!i){i=r.tmpl;d[r.key]=r;r.nodes=[];r.wrapped&&F(r,r.wrapped);return t(z(r,null,r.tmpl(t,r)))}if(!i)return[];if(typeof h==="function")h=h.call(r||{});s&&s.wrapped&&F(s,s.wrapped);h=t.isArray(h)?t.map(h,function(c){return c?D(s,r,i,c):null}):[D(s,r,i,h)];return B?t(z(r,null,h)):h},tmplItem:function(i){var h;if(i instanceof t)i=i[0];for(;i&&i.nodeType===1&&!(h=t.data(i,"tmplItem"))&&(i=i.parentNode););return h||b},template:function(i,h){if(h){if(typeof h===
"string")h=E(h);else if(h instanceof t)h=h[0]||{};if(h.nodeType)h=t.data(h,"tmpl")||t.data(h,"tmpl",E(h.innerHTML));return typeof i==="string"?t.template[i]=h:h}return i?typeof i!=="string"?t.template(null,i):t.template[i]||t.template(null,H.test(i)?i:t(i)):null},encode:function(i){return(""+i).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});t.extend(t.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){d=
{}},afterManip:function(i,h,s){var r=h.nodeType===11?t.makeArray(h.childNodes):h.nodeType===1?[h]:[];s.call(i,h);n(r);j++}})})(jQuery);/*
 
 JavaScript Debug - v0.4 - 6/22/2010
 http://benalman.com/projects/javascript-debug-console-log/

 Copyright (c) 2010 "Cowboy" Ben Alman
 Dual licensed under the MIT and GPL licenses.
 http://benalman.com/about/license/

 With lots of help from Paul Irish!
 http://paulirish.com/
*/
window.debug=function(){function t(p){if(F&&(x||!q||!q.log))F.apply(D,p)}for(var D=this,z=Array.prototype.slice,q=D.console,E={},F,x,n=9,v=["error","warn","info","debug","log"],f="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),y=f.length,g=[];--y>=0;)(function(p){E[p]=function(){n!==0&&q&&q[p]&&q[p].apply(q,arguments)}})(f[y]);for(y=v.length;--y>=0;)(function(p,u){E[u]=function(){var w=z.call(arguments),H=[u].concat(w);
g.push(H);t(H);if(q&&(n>0?n>p:v.length+n<=p))q.firebug?q[u].apply(D,w):q[u]?q[u](w):q.log(w)}})(y,v[y]);E.setLevel=function(p){n=typeof p==="number"?p:9};E.setCallback=function(){var p=z.call(arguments),u=g.length,w=u;F=p.shift()||null;x=typeof p[0]==="boolean"?p.shift():false;for(w-=typeof p[0]==="number"?p.shift():u;w<u;)t(g[w++])};return E}();(function(t){var D=t("<b/>");t.subscribe=function(z,q){function E(){return q.apply(this,Array.prototype.slice.call(arguments,1))}E.guid=q.guid=q.guid||(t.guid?t.guid++:t.event.guid++);D.bind(z,E)};t.unsubscribe=function(){D.unbind.apply(D,arguments)};t.publish=function(){D.trigger.apply(D,arguments)}})(jQuery);/*

 Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 Licensed under the MIT License (LICENSE.txt).

 Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 Thanks to: Seamus Leahy for adding deltaX and deltaY

 Version: 3.0.6

 Requires: 1.2.2+
*/
(function(t){function D(E){var F=E||window.event,x=[].slice.call(arguments,1),n=0,v=0,f=0;return E=t.event.fix(F),E.type="mousewheel",F.detail&&(n=-F.detail/3),F.wheelDeltaY!==undefined&&(f=F.wheelDeltaY/120),F.wheelDeltaX!==undefined&&(v=-1*F.wheelDeltaX/120),x.unshift(E,n,v,f),(t.event.dispatch||t.event.handle).apply(this,x)}var z=["DOMMouseScroll","mousewheel"];if(t.event.fixHooks)for(var q=z.length;q;)t.event.fixHooks[z[--q]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var E=
z.length;E;)this.addEventListener(z[--E],D,false);else this.onmousewheel=D},teardown:function(){if(this.removeEventListener)for(var E=z.length;E;)this.removeEventListener(z[--E],D,false);else this.onmousewheel=null}};t.fn.extend({mousewheel:function(E){return E?this.bind("mousewheel",E):this.trigger("mousewheel")},unmousewheel:function(E){return this.unbind("mousewheel",E)}})})(jQuery);/*

 jQuery.UI.iPad plugin
 Copyright (c) 2010 Stephen von Takach
 licensed under MIT.
 Date: 27/8/2010

 Project Home: 
 http://code.google.com/p/jquery-ui-for-ipad-and-iphone/
*/
$(function(){$.extend($.support,{touch:"ontouchend"in document});$.fn.addTouch=function(){$.support.touch&&this.each(function(t,D){D.addEventListener("touchstart",iPadTouchHandler,false);D.addEventListener("touchmove",iPadTouchHandler,false);D.addEventListener("touchend",iPadTouchHandler,false);D.addEventListener("touchcancel",iPadTouchHandler,false)})}});var lastTap=null,tapValid=false,tapTimeout=null;function cancelTap(){tapValid=false}
var rightClickPending=false,rightClickEvent=null,holdTimeout=null,cancelMouseUp=false;function cancelHold(){if(rightClickPending){window.clearTimeout(holdTimeout);rightClickPending=false;rightClickEvent=null}}function startHold(t){if(!rightClickPending){rightClickPending=true;rightClickEvent=t.changedTouches[0];holdTimeout=window.setTimeout("doRightClick();",800)}}
function doRightClick(){rightClickPending=false;var t=rightClickEvent,D=document.createEvent("MouseEvent");D.initMouseEvent("mouseup",true,true,window,1,t.screenX,t.screenY,t.clientX,t.clientY,false,false,false,false,0,null);t.target.dispatchEvent(D);D=document.createEvent("MouseEvent");D.initMouseEvent("mousedown",true,true,window,1,t.screenX,t.screenY,t.clientX,t.clientY,false,false,false,false,2,null);t.target.dispatchEvent(D);D=document.createEvent("MouseEvent");D.initMouseEvent("contextmenu",
true,true,window,1,t.screenX+50,t.screenY+5,t.clientX+50,t.clientY+5,false,false,false,false,2,null);t.target.dispatchEvent(D);cancelMouseUp=true;rightClickEvent=null}
function iPadTouchStart(t){var D=t.changedTouches[0],z="mouseover",q=document.createEvent("MouseEvent");q.initMouseEvent(z,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q);z="mousedown";q=document.createEvent("MouseEvent");q.initMouseEvent(z,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q);if(tapValid){window.clearTimeout(tapTimeout);if(D.target==lastTap){lastTap=
null;tapValid=false;z="click";q=document.createEvent("MouseEvent");q.initMouseEvent(z,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q);z="dblclick";q=document.createEvent("MouseEvent");q.initMouseEvent(z,true,true,window,1,D.screenX,D.screenY,D.clientX,D.clientY,false,false,false,false,0,null);D.target.dispatchEvent(q)}else{lastTap=D.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(t)}}else{lastTap=
D.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(t)}}
function iPadTouchHandler(t){var D="";if(!(t.touches.length>1)){switch(t.type){case "touchstart":if($(t.changedTouches[0].target).is("select"))return;iPadTouchStart(t);t.preventDefault();return false;case "touchmove":cancelHold();D="mousemove";t.preventDefault();break;case "touchend":if(cancelMouseUp){cancelMouseUp=false;t.preventDefault();return false}cancelHold();D="mouseup";break;default:return}t=t.changedTouches[0];var z=document.createEvent("MouseEvent");z.initMouseEvent(D,true,true,window,1,
t.screenX,t.screenY,t.clientX,t.clientY,false,false,false,false,0,null);t.target.dispatchEvent(z);if(D=="mouseup"&&tapValid&&t.target==lastTap){z=document.createEvent("MouseEvent");z.initMouseEvent("click",true,true,window,1,t.screenX,t.screenY,t.clientX,t.clientY,false,false,false,false,0,null);t.target.dispatchEvent(z)}}};(function(){function t(e){return(e+"").replace(m,"")}function D(e,i,h){for(var s=e.length;s<i;s++)e=h?"0"+e:e+"0";return e}function z(e){return j.call(e)==="[object Array]"}function q(e,i){if(e.indexOf)return e.indexOf(i);for(var h=0,s=e.length;h<s;h++)if(e[h]===i)return h;return-1}function E(e,i,h){var s=i["-"];i=i["+"];var r;switch(h){case "n -":s=" "+s;i=" "+i;case "n-":if(e.substr(e.length-s.length)===s)r=["-",e.substr(0,e.length-s.length)];else if(e.substr(e.length-i.length)===i)r=["+",e.substr(0,
e.length-i.length)];break;case "- n":s+=" ";i+=" ";case "-n":if(e.indexOf(s)===0)r=["-",e.substr(s.length)];else if(e.indexOf(i)===0)r=["+",e.substr(i.length)];break;case "(n)":if(e.indexOf("(")===0&&e.substr(e.length-1)===")")r=["-",e.substr(1,e.length-2)]}return r||["",e]}function F(e,i){if(!i)return 0;for(var h,s=e.getTime(),r=0,B=i.length;r<B;r++){h=i[r].start;if(h===null||s>=h)return r}return 0}function x(e){return e.split("\u00a0").join(" ").toUpperCase()}function n(e){for(var i=[],h=0,s=e.length;h<
s;h++)i[h]=x(e[h]);return i}function v(e,i,h,s){e=e.getFullYear();if(!s&&i.eras)e-=i.eras[h].offset;return e}function f(e,i){for(var h=0,s=false,r=0,B=e.length;r<B;r++){var c=e.charAt(r);switch(c){case "'":if(s)i.push("'");else h++;s=false;break;case "\\":s&&i.push("\\");s=!s;break;default:i.push(c);s=false}}return h}function y(e,i){i=i||"F";var h;h=e.patterns;var s=i.length;if(s===1){h=h[i];if(!h)throw"Invalid date format string '"+i+"'.";i=h}else if(s===2&&i.charAt(0)==="%")i=i.charAt(1);return i}
function g(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g}function p(e,i,h){e=t(e);h=h.calendar;a:{var s=h._parseRegExp;if(s){var r=s[i];if(r){i=r;break a}}else h._parseRegExp=s={};r=y(h,i).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");for(var B=["^"],c=[],k=0,l=0,A=g(),C;(C=A.exec(r))!==null;){var G=r.slice(k,C.index);k=A.lastIndex;l+=f(G,B);if(l%2)B.push(C[0]);else{G=C[0];var J=G.length;switch(G){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":G=
"(\\D+)";break;case "tt":case "t":G="(\\D*)";break;case "yyyy":case "fff":case "ff":case "f":G="(\\d{"+J+"})";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":G="(\\d\\d?)";break;case "zzz":G="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":G="([+-]?\\d\\d?)";break;case "/":G="(\\"+h["/"]+")";break;default:throw"Invalid date format pattern '"+G+"'.";}G&&B.push(G);c.push(C[0])}}f(r.slice(k),B);B.push("$");r={regExp:B.join("").replace(/\s+/g,
"\\s+"),groups:c};i=s[i]=r}l=RegExp(i.regExp).exec(e);if(l===null)return null;A=i.groups;var K=e=null,I=null,O=i=null;c=B=r=s=0;C=null;k=false;G=0;for(J=A.length;G<J;G++){var N=l[G+1];if(N){var P=A[G],L=P.length,M=parseInt(N,10);switch(P){case "dd":case "d":i=M;if(i<1||i>31)return null;break;case "MMM":case "MMMM":I=h;L=L===3;P=I.months;var Q=I.monthsGenitive||I.months,R=I._upperMonths;M=I._upperMonthsGen;if(!R){I._upperMonths=R=[n(P.names),n(P.namesAbbr)];I._upperMonthsGen=M=[n(Q.names),n(Q.namesAbbr)]}N=
x(N);I=q(L?R[1]:R[0],N);if(I<0)I=q(L?M[1]:M[0],N);if(I<0||I>11)return null;break;case "M":case "MM":I=M-1;if(I<0||I>11)return null;break;case "y":case "yy":case "yyyy":if(L<4){K=h;N=M;M=new Date;P=F(M);if(N<100){L=K.twoDigitYearMax;L=typeof L==="string"?(new Date).getFullYear()%100+parseInt(L,10):L;K=v(M,K,P);N+=K-K%100;if(N>L)N-=100}K=N}else K=M;if(K<0||K>9999)return null;break;case "h":case "hh":s=M;if(s===12)s=0;if(s<0||s>11)return null;break;case "H":case "HH":s=M;if(s<0||s>23)return null;break;
case "m":case "mm":r=M;if(r<0||r>59)return null;break;case "s":case "ss":B=M;if(B<0||B>59)return null;break;case "tt":case "t":k=h.PM&&(N===h.PM[0]||N===h.PM[1]||N===h.PM[2]);if(!k&&(!h.AM||N!==h.AM[0]&&N!==h.AM[1]&&N!==h.AM[2]))return null;break;case "f":case "ff":case "fff":c=M*Math.pow(10,3-L);if(c<0||c>999)return null;break;case "ddd":case "dddd":O=N;N=L===3;M=void 0;M=h.days;L=h._upperDays;if(!L)h._upperDays=L=[n(M.names),n(M.namesAbbr),n(M.namesShort)];O=x(O);if(N){M=q(L[1],O);if(M===-1)M=q(L[2],
O)}else M=q(L[0],O);O=M;if(O<0||O>6)return null;break;case "zzz":L=N.split(/:/);if(L.length!==2)return null;C=parseInt(L[0],10);if(C<-12||C>13)return null;L=parseInt(L[1],10);if(L<0||L>59)return null;C=C*60+(N.indexOf("-")===0?-L:L);break;case "z":case "zz":C=M;if(C<-12||C>13)return null;C*=60;break;case "g":case "gg":if(!N||!h.eras)return null;N=t(N.toLowerCase());L=0;for(M=h.eras.length;L<M;L++)if(N===h.eras[L].name.toLowerCase()){e=L;break}if(e===null)return null}}}l=new Date;A=(G=h.convert)?G.fromGregorian(l)[0]:
l.getFullYear();if(K===null)K=A;else if(h.eras)K+=h.eras[e||0].offset;if(I===null)I=0;if(i===null)i=1;if(G){l=G.toGregorian(K,I,i);if(l===null)return null}else{l.setFullYear(K,I,i);if(l.getDate()!==i)return null;if(O!==null&&l.getDay()!==O)return null}if(k&&s<12)s+=12;l.setHours(s,r,B,c);if(C!==null){h=l.getMinutes()-(C+l.getTimezoneOffset());l.setHours(l.getHours()+parseInt(h/60,10),h%60)}return l}function u(e,i,h){function s(L,M){var Q;Q=L+"";if(M>1&&Q.length<M){Q=G[M-2]+Q;return Q.substr(Q.length-
M,M)}return Q}function r(){if(J||K)return J;J=I.test(i);K=true;return J}function B(L,M){if(P)return P[M];switch(M){case 0:return L.getFullYear();case 1:return L.getMonth();case 2:return L.getDate()}}var c=h.calendar,k=c.convert;if(!i||!i.length||i==="i"){if(h&&h.name.length)if(k)h=u(e,c.patterns.F,h);else{h=new Date(e.getTime());var l=F(e,c.eras);h.setFullYear(v(e,c,l));h=h.toLocaleString()}else h=e.toString();return h}l=c.eras;var A=i==="s";i=y(c,i);h=[];var C,G=["0","00","000"],J,K,I=/([^d]|^)(d|dd)([^d]|$)/g,
O=0,N=g(),P;if(!A&&k)P=k.fromGregorian(e);for(;;){C=N.lastIndex;k=N.exec(i);C=i.slice(C,k?k.index:i.length);O+=f(C,h);if(!k)break;if(O%2)h.push(k[0]);else{C=k[0];k=C.length;switch(C){case "ddd":case "dddd":h.push((k===3?c.days.namesAbbr:c.days.names)[e.getDay()]);break;case "d":case "dd":J=true;h.push(s(B(e,2),k));break;case "MMM":case "MMMM":C=B(e,1);h.push(c.monthsGenitive&&r()?c.monthsGenitive[k===3?"namesAbbr":"names"][C]:c.months[k===3?"namesAbbr":"names"][C]);break;case "M":case "MM":h.push(s(B(e,
1)+1,k));break;case "y":case "yy":case "yyyy":C=P?P[0]:v(e,c,F(e,l),A);if(k<4)C%=100;h.push(s(C,k));break;case "h":case "hh":C=e.getHours()%12;if(C===0)C=12;h.push(s(C,k));break;case "H":case "HH":h.push(s(e.getHours(),k));break;case "m":case "mm":h.push(s(e.getMinutes(),k));break;case "s":case "ss":h.push(s(e.getSeconds(),k));break;case "t":case "tt":C=e.getHours()<12?c.AM?c.AM[0]:" ":c.PM?c.PM[0]:" ";h.push(k===1?C.charAt(0):C);break;case "f":case "ff":case "fff":h.push(s(e.getMilliseconds(),3).substr(0,
k));break;case "z":case "zz":C=e.getTimezoneOffset()/60;h.push((C<=0?"+":"-")+s(Math.floor(Math.abs(C)),k));break;case "zzz":C=e.getTimezoneOffset()/60;h.push((C<=0?"+":"-")+s(Math.floor(Math.abs(C)),2)+":"+s(Math.abs(e.getTimezoneOffset()%60),2));break;case "g":case "gg":c.eras&&h.push(c.eras[F(e,l)].name);break;case "/":h.push(c["/"]);break;default:throw"Invalid date format pattern '"+C+"'.";}}}return h.join("")}var w={},H={en:{}};H["default"]=H.en;w.extend=function(e){for(var i=arguments[1]||{},
h=2,s=arguments.length;h<s;h++){var r=arguments[h];if(r)for(var B in r){var c=r[B];if(typeof c!=="undefined")if(e&&(j.call(c)==="[object Object]"||z(c))){var k=i[B];k=k&&(j.call(k)==="[object Object]"||z(k))?k:z(c)?[]:{};i[B]=this.extend(true,k,c)}else i[B]=c}}return i};w.findClosestCulture=function(e){var i;if(!e)return this.culture||this.cultures["default"];if(j.call(e)==="[object String]")e=e.split(",");if(z(e)){var h,s=this.cultures,r=e,B,c=r.length,k=[];for(B=0;B<c;B++){e=t(r[B]);e=e.split(";");
h=t(e[0]);if(e.length===1)e=1;else{e=t(e[1]);if(e.indexOf("q=")===0){e=e.substr(2);e=parseFloat(e,10);e=isNaN(e)?0:e}else e=1}k.push({lang:h,pri:e})}k.sort(function(A,C){return A.pri<C.pri?1:-1});for(B=0;B<c;B++){h=k[B].lang;if(i=s[h])return i}for(B=0;B<c;B++){h=k[B].lang;do{r=h.lastIndexOf("-");if(r===-1)break;h=h.substr(0,r);if(i=s[h])return i}while(1)}for(B=0;B<c;B++){h=k[B].lang;for(var l in s){r=s[l];if(r.language==h)return r}}}else if(typeof e==="object")return e;return i||null};w.preferCulture=
function(e){this.culture=this.findClosestCulture(e)||this.cultures["default"]};w.localize=function(e,i,h){if(typeof i!=="string")i=this.culture.name||this.culture||"default";i=this.cultures[i]||{name:i};var s=H[i.name];if(arguments.length===3){s||(s=H[i.name]={});s[e]=h}else{if(s)h=s[e];if(typeof h==="undefined"){if(s=H[i.language])h=s[e];if(typeof h==="undefined")h=H["default"][e]}}return typeof h==="undefined"?null:h};w.format=function(e,i,h){h=this.findClosestCulture(h);if(typeof e==="number"){var s=
e;if(!i||i==="i")e=h.name.length?s.toLocaleString():s.toString();else{i=i||"D";h=h.numberFormat;e=Math.abs(s);var r=-1;if(i.length>1)r=parseInt(i.slice(1),10);var B=i.charAt(0).toUpperCase(),c;switch(B){case "D":i="n";if(r!==-1)e=D(""+e,r,true);if(s<0)e=-e;break;case "N":c=h;case "C":c=c||h.currency;case "P":c=c||h.percent;i=s<0?c.pattern[0]:c.pattern[1]||"n";if(r===-1)r=c.decimals;b:{var k=e*(B==="P"?100:1);B=c;c=B.groupSizes;e=c[0];s=1;var l=Math.pow(10,r),A=Math.round(k*l)/l;isFinite(A)||(A=k);
l="";l=(A+"").split(/e/i);A=l.length>1?parseInt(l[1],10):0;k=l[0];l=k.split(".");k=l[0];l=l.length>1?l[1]:"";if(A>0){l=D(l,A,false);k+=l.slice(0,A);l=l.substr(A)}else if(A<0){A=-A;k=D(k,A+1);l=k.slice(-A,k.length)+l;k=k.slice(0,-A)}l=r>0?B["."]+(l.length>r?l.slice(0,r):D(l,r)):"";r=k.length-1;B=B[","];for(A="";r>=0;){if(e===0||e>r){e=k.slice(0,r+1)+(A.length?B+A+l:l);break b}A=k.slice(r-e+1,r+1)+(A.length?B+A:"");r-=e;if(s<c.length){e=c[s];s++}}e=k.slice(0,r+1)+B+A+l}break;default:throw"Bad number format specifier: "+
B;}c=/n|\$|-|%/g;for(s="";;){r=c.lastIndex;B=c.exec(i);s+=i.slice(r,B?B.index:i.length);if(!B)break;switch(B[0]){case "n":s+=e;break;case "$":s+=h.currency.symbol;break;case "-":if(/[1-9]/.test(e))s+=h["-"];break;case "%":s+=h.percent.symbol}}e=s}}else if(e instanceof Date)e=u(e,i,h);return e};w.parseInt=function(e,i,h){return Math.floor(this.parseFloat(e,i,h))};w.parseFloat=function(e,i,h){if(typeof i==="string"){h=i;i=10}h=this.findClosestCulture(h);var s=NaN,r=h.numberFormat;if(e.indexOf(h.numberFormat.currency.symbol)>
-1){e=e.replace(h.numberFormat.currency.symbol,"");e=e.replace(h.numberFormat.currency["."],h.numberFormat["."])}e=t(e);if(o.test(e))s=parseFloat(e,i);else if(!i&&b.test(e))s=parseInt(e,16);else{h=E(e,r,r.pattern[0]);i=h[0];h=h[1];if(i===""&&r.pattern[0]!=="-n"){h=E(e,r,"-n");i=h[0];h=h[1]}i=i||"+";var B;e=h.indexOf("e");if(e<0)e=h.indexOf("E");if(e<0){B=h;e=null}else{B=h.substr(0,e);e=h.substr(e+1)}var c=r["."],k=B.indexOf(c);if(k<0){h=B;B=null}else{h=B.substr(0,k);B=B.substr(k+c.length)}c=r[","];
h=h.split(c).join("");k=c.replace(/\u00A0/g," ");if(c!==k)h=h.split(k).join("");i+=h;if(B!==null)i+="."+B;if(e!==null){r=E(e,r,"-n");i+="e"+(r[0]||"+")+r[1]}if(a.test(i))s=parseFloat(i)}return s};w.parseDate=function(e,i,h){h=this.findClosestCulture(h);var s,r;if(i){if(typeof i==="string")i=[i];if(i.length){r=0;for(var B=i.length;r<B;r++){var c=i[r];if(c)if(s=p(e,c,h))break}}}else{i=h.calendar.patterns;for(r in i)if(s=p(e,i[r],h))break}return s||null};var d=w.cultures=w.cultures||{};d=d["default"]=
d.en=w.extend(true,{name:"en",englishName:"English",nativeName:"English",isRTL:false,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday",
"Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",
f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}}},d.en);d.calendar=d.calendar||d.calendars.standard;var m=/^\s+|\s+$/g,o=/^[+-]?infinity$/i,b=/^0x[a-f0-9]+$/i,a=/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,j=Object.prototype.toString;jQuery.global=w})();timeglider=window.timeglider||{version:"0.1.0"};timeglider.TG_Date={};
(function(t){function D(g){return parseInt(g,10)}function z(g){var p=parseInt(g,10);return p>9||p<0?String(g):"0"+p}t=timeglider;var q=jQuery,E={},F={},x={},n={},v={},f=/^(\-?\d+)?(\-\d{1,2})?(\-\d{1,2})?(?:T| )?(\d{1,2})?(?::)?(\d{1,2})?(?::)?(\d{1,2})?(\+|\-)?(\d{1,2})?(?::)?(\d{1,2})?/;t.TG_Date=function(g,p,u){var w,H,d;u=u||0;if(typeof g=="number"){w=H=y.getDateFromSec(g);d=g+u}else if(typeof g!=="object"){if(g=="today")g=y.getToday();w=H=g}if(f.test(w)){g=y.parse8601(w);if(g.tz_ho)g=y.toFromUTC(g,
{hours:g.tz_ho,minutes:g.tz_mi},"to");q.extend(this,g);this.rd=y.getRataDie(this);this.mo_num=this.ye>0?(this.ye-1)*12+this.mo:-1*((Math.abs(this.ye)-1)*12+(12-(this.mo-1)));this.sec=d||(this.rd>0?1:-1)*(Math.abs(this.rd)*86400+this.ho*3600+(this.mi-1)*60);this.date_display=p?p.toLowerCase().substr(0,2):"da";this.dateStr=H}else return{error:"invalid date"};return this};var y=t.TG_Date;y.getTimeUnitSerial=function(g,p){var u=0,w;w=g.ye<0?Math.ceil:Math.floor;switch(p){case "da":u=g.rd;break;case "mo":u=
g.mo_num;break;case "ye":u=g.ye;break;case "de":u=w(g.ye/10);break;case "ce":u=w(g.ye/100);break;case "thou":u=w(g.ye/1E3);break;case "tenthou":u=w(g.ye/1E4);break;case "hundredthou":u=w(g.ye/1E5);break;case "mill":u=w(g.ye/1E6);break;case "tenmill":u=w(g.ye/1E7);break;case "hundredmill":u=w(g.ye/1E8);break;case "bill":u=w(g.ye/1E9)}return u};y.getMonthDays=function(g,p){return y.isLeapYear(p)==true&&g==2?29:y.monthsDayNums[g]};y.twentyFourToTwelve=function(g){var p={};p.ye=g.ye;p.mo=g.mo;p.da=g.da;
p.ho=g.ho;p.mi=g.mi;p.ampm="am";if(g.ho)if(g.ho>=12){p.ampm="pm";p.ho=g.ho>12?g.ho-12:12}else if(g.ho==0){p.ho=12;p.ampm="am"}else p.ho=g.ho;else{p.ho=12;p.mi=0;p.ampm="am"}return p};y.getMonthAdj=function(g,p){var u=y.getDateFromMonthNum(g);switch(u.mo){case 1:case 3:case 5:case 7:case 8:case 10:case 12:u=Math.floor(p+p/28*3);return{width:u,days:31};case 2:if(y.isLeapYear(u.ye)==true){u=Math.floor(p+p/28);return{width:u,days:29}}else return{width:p,days:28};default:u=Math.floor(p+p/28*2);return{width:u,
days:30}}};y.getDateFromMonthNum=function(g){var p=0;if(g>0){p=g%12;if(p==0)p=12;g=Math.ceil(g/12)}else{p=Math.abs(g)%12;p=12-p+1;if(p==13)p=1;g=-1*Math.ceil(Math.abs(g)/12)}return{ye:g,mo:p}};y.getMonthWidth=function(g,p,u){var w=u/28,H;switch(g){case 1:case 3:case 5:case 7:case 8:case 10:case 12:H=3;break;case 4:case 6:case 9:case 11:H=2;break;case 2:H=y.isLeapYear(p)==true?1:0}return{width:Math.floor(u+w*H),numDays:28+H}};y.getToday=function(){var g=new Date;return g.getFullYear()+"-"+(g.getMonth()+
1)+"-"+g.getDate()+" "+g.getHours()+":"+g.getMinutes()+":00"};y.getMonthFromRemDays=function(g,p){var u=0;var w=u=0;u=y.isLeapYear(p)?1:0;if(g<=31){w=1;u=g}else if(g>31&&g<=59+u){w=2;u=g-(31+u)}else if(g>59+u&&g<=90+u){w=3;u=g-(59+u)}else if(g>90+u&&g<=120+u){w=4;u=g-(90+u)}else if(g>120+u&&g<=151+u){w=5;u=g-(120+u)}else if(g>151+u&&g<=181+u){w=6;u=g-(151+u)}else if(g>181+u&&g<=212+u){w=7;u=g-(181+u)}else if(g>212+u&&g<=243+u){w=8;u=g-(212+u)}else if(g>243+u&&g<=273+u){w=9;u=g-(243+u)}else if(g>273+
u&&g<=304+u){w=10;u=g-(273+u)}else if(g>304+u&&g<=334+u){w=11;u=g-(304+u)}else{w=12;u=g-(334+u)}return{mo:w,da:u}};y.getDateFromRD=function(g){if(n[g])return n[g];for(var p=Math.floor(g),u=Math.floor(p/146097)*400,w=p-Math.floor(p/146097)*146097,H=1,d=u+1,m=d+400;d<=m;d++)if(w>365){w-=365;if(y.isLeapYear(d))w-=1;H++}else d=m;u+=H;if(w==0)w=1;w=y.getMonthFromRemDays(w,u);H=(g-p)*1440;p=Math.floor(H%60);H=Math.floor(H/60);if(y.isLeapYear(u)&&w.mo==2)w.da+=1;p=u+"-"+w.mo+"-"+w.da+" "+H+":"+p+":00";return n[g]=
p};y.getDateFromSec=function(g){if(v[g])return v[g];var p=y.getDateFromRD(g/86400);return v[g]=p};y.isLeapYear=function(g){return g%400==0?true:g%100==0?false:g%4==0?true:false};y.getRataDie=function(g){function p(b,a){if(F[b+"-"+a])return F[b+"-"+a];for(var j=0,e=b;e<a;e++)j+=y.isLeapYear(e)?366:365;return F[b+"-"+a]=j}function u(b,a){var j;switch(b){case 1:j=0;break;case 2:j=31;break;case 3:j=59;break;case 4:j=90;break;case 5:j=120;break;case 6:j=151;break;case 7:j=181;break;case 8:j=212;break;
case 9:j=243;break;case 10:j=273;break;case 11:j=304;break;case 12:j=334}if(b>2)if(y.isLeapYear(a))j+=1;return j}var w=g.ye,H=g.mo;g=g.da;var d=0;if(E[w+"-"+H+"-"+g])return E[w+"-"+H+"-"+g];if(w>=0){if(w==0)w=1;d=Math.floor(w/400)*146097;var m=parseInt(p(w-w%400,w)),o=parseInt(u(H,w));d=d+m+o+g-366}else if(w<0)d=y.getBCRataDie({ye:w,mo:H,da:g});return E[w+"-"+H+"-"+g]=d};y.monthNamesLet=["","J","F","M","A","M","J","J","A","S","O","N","D"];y.monthsDayNums=[0,31,28,31,30,31,30,31,31,30,31,30,31,29];
y.units=["da","mo","ye","de","ce","thou","tenthou","hundredthou","mill","tenmill","hundredmill","bill"];y.getBCRataDie=function(g){var p=g.ye,u=g.mo;g=g.da;if(x[p+"-"+u+"-"+g])return x[p+"-"+u+"-"+g];if(u==0)u=1;if(g==0)g=1;var w=-1*((Math.abs(p)-1)*366+[0,335,306,275,245,214,184,153,122,92,61,31,0][u]+(y.monthsDayNums[u]-g+1));return x[p+"-"+u+"-"+g]=w};y.setCulture=function(g){jQuery.global.culture=jQuery.global.cultures[g];y.monthNames=q.merge([""],jQuery.global.culture.calendar.months.names);
y.monthNamesAbbr=q.merge([""],jQuery.global.culture.calendar.months.namesAbbr);y.dayNames=jQuery.global.culture.calendar.days.names;y.dayNamesAbbr=jQuery.global.culture.calendar.days.namesAbbr;y.dayNamesShort=jQuery.global.culture.calendar.days.namesShort;y.patterns=jQuery.global.culture.calendar.patterns};y.prototype={format:function(g,p,u){u=u||{hours:0,minutes:0};if(p==true)switch(this.date_display.substr(0,2)){case "no":return"";case "ye":g="yyyy";break;case "mo":g="MMM yyyy";break;case "da":g=
"MMM d, yyyy";break;case "ho":g="MMM d, yyyy h:mm tt";break;default:g="f"}if(this.ye>-27E4){p=y.toFromUTC(_.clone(this),u,"from");p=new Date(p.ye,p.mo-1,p.da,p.ho,p.mi,p.se,0);return q.global.format(p,g)}else return this.ye}};y.getTimeOffset=function(g){g=g.replace(/[^-\d:]/gi,"");var p=g.split(":"),u=parseInt(p[0],10);p=parseInt(p[1],10);var w=u+(u<0?-1:1)*(p/60);return{decimal:w,hours:u,minutes:p,seconds:w*3600,string:g}};y.tzOffsetStr=function(g,p){if(g){if(g.length==19)g+=p;else if(g.length==
16)g+=":00"+p;return g}};y.parse8601=function(g){var p,u,w,H,d,m,o,b;d=function(a){return a?parseInt(a.replace("-",""),10):0};b=g.match(f);g=parseInt(b[1]);if(!g)return{error:"invalid date; no year provided"};p=d(b[2])||1;u=d(b[3])||1;w=d(b[4])||1;H=d(b[5])||0;d=d(b[6])||0;m=b[7]||"+";o=parseInt(b[8],10)||0;if(m=="-")o*=-1;b=parseInt(b[9],10)||0;if(m=="-")b*=-1;return{ye:g,mo:p,da:u,ho:w,mi:H,se:d,tz_ho:o,tz_mi:b}};y.getLastDayOfMonth=function(g,p){var u=[0,31,28,31,30,31,30,31,31,30,31,30,31],w=
0;return w=p==2&&y.isLeapYear(g)==true?29:u[p]};y.getDateTimeStrings=function(g){var p=y.parse8601(g);g=p.ye+"-"+z(p.mo)+"-"+z(p.da);var u="pm";if(p.ho>12){p.ho-=12;u="pm"}else{if(p.ho==0)p.ho="12";u="am"}p=D(p.ho)+":"+z(p.mi)+" "+u;return{date:g,time:p}};y.transValidateDateString=function(g){if(!g)return false;var p=g.match(/^(\-?\d+|today|now) ?(bce?)?-?(\d{1,2})?-?(\d{1,2})?/);g=y.zeroButt;if(p){var u=p[1],w=p[2]||"",H=p[3]||"07";p=p[4]||"1";if(parseInt(u,10)<0||w.substr(0,1)=="b")u=-1*Math.abs(u);
return y.validateDate(u,H,p)?u+"-"+g(H)+"-"+g(p):false}else return false};y.transValidateTimeString=function(g){if(!g)return"12:00:00";g=g.toLowerCase().match(/^(\d{1,2}|noon):?(\d{1,2})?:?(\d{1,2})? ?(am|pm)?/i);var p="";p=y.zeroButt;if(g[1])if(g[0]=="noon")p="12:00:00";else{var u=parseInt(g[1],10)||12,w=parseInt(g[2],10)||0,H=parseInt(g[3],10)||0;g=g[4]||"am";if(y.validateTime(u,w,H)==false)return false;if(g=="pm"&&u<12)u+=12;p=p(u)+":"+p(w)+":"+p(H)}else p=false;return p};y.validateTime=function(g,
p,u){if(g<0||g>23||p<0||p>59||u<0||u>59)return false;return true};y.validateDate=function(g,p,u){var w=y.getMonthDays(p,g);if(u>w||u<=0)return false;if(p>12||p<0)return false;if(g==0)return false;return true};y.zeroButt=function(g){g=parseInt(g,10);return g>9?String(g):"0"+g};y.toFromUTC=function(g,p,u){var w=0,H=[0,31,28,31,30,31,30,31,31,30,31,30,31,29];w={};if(u=="from"){w.ho=-1*p.hours;w.mi=-1*p.minutes}else if(u=="to"){w.ho=p.hours;w.mi=p.minutes}else{w.ho=-1*g.tz_ho;w.mi=-1*g.tz_mi}if(w.ho==
0&&w.mi==0)return g;u=g.ho+g.mi/60+(-1*w.ho+w.mi*-1/60);if(u<0){w=24+u;if(g.da>1)g.da-=1;else if(g.mo==1){g.ye-=1;g.mo=12;g.da=31}else{g.mo-=1;g.da=y.getLastDayOfMonth(g.ye,g.mo)}}else if(u>=24){w=u-24;if(y.isLeapYear(g.ye)&&g.mo==2&&g.da==28)g.da=29;else if(g.da==H[g.mo]){if(g.mo==12){g.ye+=1;g.mo=1}else g.mo+=1;g.da=1}else g.da+=1}else w=u;H=function(d){d=Math.abs(d);var m=Math.floor(d);return{ho:m,mi:Math.round((d-m)*60),se:0}}(w);g.ho=H.ho;g.mi=H.mi;if(p){g.tz_ho=p.tz_ho;g.tz_mi=p.tz_mi}else{g.tz_ho=
0;g.tz_mi=0}return{ye:g.ye,mo:g.mo,da:g.da,ho:g.ho,mi:g.mi,se:g.se}};y.TGSecToUnixSec=function(g){return g-62135661873};y.JSDateToISODateString=function(g){var p=function(u){return u<10?"0"+u:u};return g.getUTCFullYear()+"-"+p(g.getUTCMonth()+1)+"-"+p(g.getUTCDate())+" "+p(g.getUTCHours())+":"+p(g.getUTCMinutes())+":"+p(g.getUTCSeconds())};y.timezones=[{offset:"-12:00",name:"Int'l Date Line West"},{offset:"-11:00",name:"Bering & Nome"},{offset:"-10:00",name:"Alaska-Hawaii Standard Time"},{offset:"-10:00",
name:"U.S. Hawaiian Standard Time"},{offset:"-10:00",name:"U.S. Central Alaska Time"},{offset:"-09:00",name:"U.S. Yukon Standard Time"},{offset:"-08:00",name:"U.S. Pacific Standard Time"},{offset:"-07:00",name:"U.S. Mountain Standard Time"},{offset:"-07:00",name:"U.S. Pacific Daylight Time"},{offset:"-06:00",name:"U.S. Central Standard Time"},{offset:"-06:00",name:"U.S. Mountain Daylight Time"},{offset:"-05:00",name:"U.S. Eastern Standard Time"},{offset:"-05:00",name:"U.S. Central Daylight Time"},
{offset:"-04:00",name:"U.S. Atlantic Standard Time"},{offset:"-04:00",name:"U.S. Eastern Daylight Time"},{offset:"-03:30",name:"Newfoundland Standard Time"},{offset:"-03:00",name:"Brazil Standard Time"},{offset:"-03:00",name:"Atlantic Daylight Time"},{offset:"-03:00",name:"Greenland Standard Time"},{offset:"-02:00",name:"Azores Time"},{offset:"-01:00",name:"West Africa Time"},{offset:"00:00",name:"Greenwich Mean Time/UTC"},{offset:"00:00",name:"Western European Time"},{offset:"01:00",name:"Central European Time"},
{offset:"01:00",name:"Middle European Time"},{offset:"01:00",name:"British Summer Time"},{offset:"01:00",name:"Middle European Winter Time"},{offset:"01:00",name:"Swedish Winter Time"},{offset:"01:00",name:"French Winter Time"},{offset:"02:00",name:"Eastean EU"},{offset:"02:00",name:"USSR-zone1"},{offset:"02:00",name:"Middle European Summer Time"},{offset:"02:00",name:"French Summer Time"},{offset:"03:00",name:"Baghdad Time"},{offset:"03:00",name:"USSR-zone2"},{offset:"03:30",name:"Iran"},{offset:"04:00",
name:"USSR-zone3"},{offset:"05:00",name:"USSR-zone4"},{offset:"05:30",name:"Indian Standard Time"},{offset:"06:00",name:"USSR-zone5"},{offset:"06:30",name:"North Sumatra Time"},{offset:"07:00",name:"USSR-zone6"},{offset:"07:00",name:"West Australian Standard Time"},{offset:"07:30",name:"Java"},{offset:"08:00",name:"China & Hong Kong"},{offset:"08:00",name:"USSR-zone7"},{offset:"08:00",name:"West Australian Daylight Time"},{offset:"09:00",name:"Japan"},{offset:"09:00",name:"Korea"},{offset:"09:00",
name:"USSR-zone8"},{offset:"09:30",name:"South Australian Standard Time"},{offset:"09:30",name:"Central Australian Standard Time"},{offset:"10:00",name:"Guam Standard Time"},{offset:"10:00",name:"USSR-zone9"},{offset:"10:00",name:"East Australian Standard Time"},{offset:"10:30",name:"Central Australian Daylight Time"},{offset:"10:30",name:"South Australian Daylight Time"},{offset:"11:00",name:"USSR-zone10"},{offset:"11:00",name:"East Australian Daylight Time"},{offset:"12:00",name:"New Zealand Standard Time"},
{offset:"12:00",name:"Int'l Date Line East"},{offset:"13:00",name:"New Zealand Daylight Time"}];y.boil=D;y.unboil=z})(timeglider);(function(t){var D=t.levelHeight=12;t.TG_Org=function(){var z=this,q=t.icon_folder;this.blocks=[];this.ids=[];this.vis=[];this.pol=-1;this.placedBlocks=[];this.freshBlocks=[];this.addBlock=function(x,n){x.right=x.left+x.width;x.bottom=x.top+x.height;x.tickScope=n;z.freshBlocks.push(x);z.blocks.push(x)};this.clearFresh=function(){z.freshBlocks=[]};this.getBorg=function(){return this};this.getBlocks=function(){return this.blocks};this.getHTML=function(x,n){if(x=="sweep")this.vis=[];this.freshBlocks.sort(E);
var v,f,y="",g="",p="",u=0,w={},H=this.freshBlocks.length;f="";var d=0;v=0;y="";for(var m=0;m<H;m++){w=this.freshBlocks[m];d=0;if(w.tickScope==x)if(_.indexOf(w.id,this.vis)==-1){this.vis.push(w.id);if(w.html&&w.html.substr(0,4)=="<div")p+="<div style='left:"+w.left+"px' id='"+w.id+"'"+w.html.substr(4);else{if(w.image){y=w.shape&&w.image.display_class=="inline"?" style='width:"+w.shape.img_wi+"px;height:auto;top:-"+w.shape.img_ht+"px'":"";d=0;y="<div class='timeglider-event-image-"+w.image.display_class+
"'><img src='"+w.image.src+"' "+y+"></div>"}else y="";v=n-18;if(w.y_position>0)w.top=z.pol*w.y_position;else{w.attempts=0;F(w,v)}if(n&&z.pol==-1&&Math.abs(w.top)>v)p+="<div class='timeglider-more-plus' style='left:"+w.left+"px; top:-"+n+"px'>"+(w.icon?"<img src='"+q+w.icon+"'>":"+")+"</div>";else if(w.fontsize>2){f=w.span_color?";background-color:"+w.span_color:"";w.fontsize<10?w.opacity=w.fontsize/10:w.opacity=1;if(w.span==true){v="timeglider-event-spanning";f="<div data-starts='"+w.startdateObj.sec+
"' data-ends='"+w.enddateObj.sec+"' class='timeglider-event-spanner' style='top:px;height:"+w.fontsize+"px;width:"+w.spanwidth+"px"+f+"'></div>"}else f=v="";g=w.icon?"<img class='timeglider-event-icon' src='"+q+w.icon+"' style='height:"+w.fontsize+"px;left:-"+(w.fontsize+2)+"px; top:"+d+"px'>":"";u=z.pol===1?42:-12;p+="<div class='timeglider-timeline-event "+w.css_class+" "+v+"' id='"+w.id+"' style='width:"+w.width+"px;height:"+w.height+"px;left:"+w.left+"px;opacity:"+w.opacity+";top:"+(w.top+u)+
"px;font-size:"+w.fontsize+"px;'>"+g+y+f+"<div class='timeglider-event-title' style='top:"+d+"px'>"+w.title+"</div></div>"}}}}return{html:p}};var E=function(x,n){var v=n.importance,f=x.importance;if(x.image&&n.image)return-1;return v<f?-1:v>f?1:0},F=function(x,n){var v=false,f=z.placedBlocks,y=z.placedBlocks.length,g=false;if(y==0||Math.abs(x.top)>n)g=false;else for(var p=0;p<y;p++){a:{v=f[p];if(!(x.left+-16>v.right||x.right<v.left+-16||x.bottom<v.top+-6))if(x.left>=v.left&&x.left<=v.right||x.right>=
v.left&&x.right<=v.right||x.right>=v.right&&x.left<=v.left||x.right<=v.right&&x.left>=v.left)if(x.bottom<=v.bottom&&x.bottom>=v.top||x.top<=v.bottom&&x.top>=v.top||x.bottom==v.bottom&&x.top==v.top){v=true;break a}v=false}if(v==true){if(z.pol===-1){x.top-=D;x.bottom-=D}else{x.top+=D;x.bottom+=D}x.attempts++;F(x,n);g=true;break}}g==false&&z.placedBlocks.push(x)}}})(timeglider);(function(t){var D=t.TG_Date,z=jQuery,q={},E=D.units,F;t.TG_EventCollection=Backbone.Collection.extend({eventHash:{},setTimelineHash:function(x,n){this.eventHash[x]=n},getTimelineHash:function(x){return this.eventHash[x]},model:t.TG_Event});t.TG_Event=Backbone.Model.extend({urlRoot:"/event",defaults:{title:"Untitled"},initialize:function(x){if(x.image){if(typeof x.image=="string")x.image={id:x.id,src:x.image,display_class:x.image_class||"above",width:0,height:0};else{x.image.display_class=x.image.display_class||
"above";x.image.width=0;x.image.height=0}this.getEventImageSize(x.image)}else x.image="";x.title=x.title.replace(/&amp;/g,"&");x.titleWidth=t.getStringWidth(x.title);this.set(x)},validate:function(){},getEventImageSize:function(x){function n(g,p){return function(){return p.apply(g,arguments)}}var v=this,f=new Image,y=f.src=x.src;f.onerror=n(f,function(){debug.log("error loading image:"+y);v.set({image:""})});f.onload=n(f,function(){v.get("image").height=this.height;v.get("image").width=this.width})},
reIndex:function(x){var n=this,v=x||false,f=n.get("cache"),y=n.get("id"),g=n.get("startdateObj"),p=n.get("enddateObj"),u=n.get("timelines"),w=f.startdateObj||g,H={},d={},m=0,o=0;x=_.union(f.timelines,u);var b=t.TG_Date,a=n.get("mediator"),j=a.timelineCollection,e=a.eventCollection;_.each(x,function(i){H=j.get(i);d=e.getTimelineHash(i);d.all=_.reject(d.all,function(r){return r==y});_.each(b.units,function(r){m=b.getTimeUnitSerial(w,r);if(d[r][m]!==undefined)d[r][m]=_.reject(d[r][m],function(B){return B==
y});if(v!=true)if(z.inArray(i,u)!=-1){o=b.getTimeUnitSerial(g,r);if(d[r][o]!==undefined)d[r][o].push(y);else d[r][o]=[y]}});v!=true&&z.inArray(i,u)!=-1&&d.all.push(y);H.get("bounds");var h=[];_.each(d.all,function(r){r=e.get(r);h.push(r.get("startdateObj").sec);h.push(r.get("enddateObj").sec)});H.set({bounds:{first:_.min(h),last:_.max(h)}});var s=H.get("spans");f.span&&delete s["s_"+y];if(v!=true)if(n.get("span")==true)s["s_"+y]={id:y,start:g.sec,end:p.sec};H.set({has_events:d.all.length})})}});t.TG_TimelineCollection=
Backbone.Collection.extend({model:t.TG_Timeline});t.TG_Timeline=Backbone.Model.extend({urlRoot:"/timeline",defaults:{initial_zoom:25,timezone:"00:00",title:"Untitled",events:[],legend:[]},_chewTimeline:function(x){F=x.mediator;x.timeline_id=x.id;q=F.options;var n={all:[],da:[],mo:[],ye:[],de:[],ce:[],thou:[],tenthou:[],hundredthou:[],mill:[],tenmill:[],hundredmill:[],bill:[]};x.spans={};x.hasImagesAbove=false;x.startSeconds=[];x.endSeconds=[];x.size_importance=x.size_importance=="false"||x.size_importance==
"0"?0:1;x.is_public=x.is_public=="false"||x.is_public=="0"?0:1;x.timeOffset=D.getTimeOffset(x.timezone||"00:00");if(!x.color)x.color="#333333";if(x.events.length>0){for(var v,f,y,g,p=x.events.length,u=0;u<p;u++){f=x.events[u];if(f.id)y=f.id;else f.id=y="anon"+this.anonEventId++;f.importance=parseInt(f.importance,10)+q.boost;if(f.map)if(F.main_map){if(timeglider.mapping.ready)f.map.marker_instance=timeglider.mapping.addAddMarkerToMap(f,F.main_map)}else t.googleMapsLoad();f.callbacks=f.callbacks||{};
v=typeof f.date_display=="object"?"da":f.date_display||f.date_limit||"da";f.date_display=v.toLowerCase().substr(0,2);if(x.timeOffset.seconds){f.startdate=D.tzOffsetStr(f.startdate,x.timeOffset.string);if(f.enddate)f.enddate=D.tzOffsetStr(f.enddate,x.timeOffset.string)}f.startdateObj=new D(f.startdate,f.date_display);if(f.enddate&&f.enddate!==f.startdate){f.enddateObj=new D(f.enddate,f.date_display);f.span=true;x.spans["s_"+f.id]={id:f.id,start:f.startdateObj.sec,end:f.enddateObj.sec}}else{f.enddateObj=
f.startdateObj;f.span=false}if(f.image)if(f.image.display_class!="inline")x.hasImagesAbove=true;x.startSeconds.push(f.startdateObj.sec);x.endSeconds.push(f.enddateObj.sec);f.cache={timelines:[x.timeline_id],span:f.span,startdateObj:_.clone(f.startdateObj),enddateObj:_.clone(f.enddateObj)};f.icon=!f.icon||f.icon==="none"?"":f.icon;if(!isNaN(f.startdateObj.sec)&&!isNaN(f.enddateObj.sec)){n.all.push(y);for(var w=E.length,H=0;H<w;H++){v=E[H];g=D.getTimeUnitSerial(f.startdateObj,v);if(n[v][g]!==undefined)_.indexOf(n[v][g],
y)===-1&&n[v][g].push(y);else n[v][g]=[y]}f.mediator=F;if(F.eventCollection.get(y))F.eventCollection.get(y).get("timelines").push(x.timeline_id);else{f.timelines=[x.timeline_id];f=new t.TG_Event(f);F.eventCollection.add(f)}}}p=z.merge(x.startSeconds,x.endSeconds);p=_.sortBy(p,function(d){return parseInt(d)});x.bounds={first:_.first(p),last:_.last(p)};p=D.getDateFromSec(x.bounds.first);x.focus_date=x.focus_date||p;x.focusDateObj=new D(x.focus_date);x.has_events=1}else{x.focus_date=x.focus_date||"today";
x.focusDateObj=new D(x.focus_date);x.bounds={first:x.focusDateObj.sec,last:x.focusDateObj.sec+86400};x.has_events=0}x.hasLegend=x.legend.length>0?true:false;x.display="expanded";F.eventCollection.setTimelineHash(x.timeline_id,n);delete x.events;return x},initialize:function(x){this.set(this._chewTimeline(x));this.bind("change",function(){})}})})(timeglider);(function(t){var D=t.TG_Date,z="",q="",E={},F=0,x=0,n=0,v="",f=jQuery,y={},g="",p,u,w,H=f.support.touch?"touchstart":"click";t.TG_PlayerView=function(d,m){var o=this;q=m;E=q.options;z="#"+d._id;g=d._id;v=E.base_namespace+"#"+g;this.gens=0;this.setImageLaneHeight(E.image_lane_height);this._views={PLACE:z,CONTAINER:z+" .timeglider-container",DATE:z+" .timeglider-date-display",TIMELINE_MENU:z+" .timeglider-timeline-menu",TIMELINE_MENU_UL:z+" .timeglider-timeline-menu ul",TIMELINE_LIST_BT:z+" .timeglider-list-bt",
SLIDER_CONTAINER:z+" .timeglider-slider-container",SLIDER:z+" .timeglider-slider",ZOOM_DISPLAY:z+" .timeglider-zoomlevel-display",TRUCK:z+" .timeglider-truck",CENTERLINE:z+" .timeglider-centerline",TICKS:z+" .timeglider-ticks",HANDLE:z+" .timeglider-handle",FOOTER:z+" .timeglider-footer",FILTER_BT:z+" .timeglider-filter-bt",FILTER_BOX:z+" .timeglider-filter-box",SETTINGS_BT:z+" .timeglider-settings-bt"};p=this._views.CONTAINER;u=this._views.TICKS;w=this._views.DATE;this.initTimelineVOffset=100;this.tick_height=
34;this.dragScopeState={state:"okay",pos:0};this._templates={};this._templates={test:"testola",event_modal_small:"<div class='tg-modal timeglider-ev-modal ui-widget-content' id='${id}_modal'><div class='close-button close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>${title}</h4><p>{{html image}}{{html description}}</p><ul class='timeglider-ev-modal-links'>{{html links}}</ul></div>",event_modal_iframe:"<div class='tg-modal timeglider-ev-modal ui-widget-content tg-iframe-modal' id='${id}_modal'><div class='close-button close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>{{html title}}</h4><iframe frameborder='none' src='${link}'></iframe></div>",
event_modal_full:f.template(null,"<div class='tg-modal full_modal' id='ev_${id}_modal'><div class='full_modal_scrim'></div><div class='full_modal_panel'><div class='close-button full_modal_close'>x</div><div class='dateline'>{{html dateline}}</div><table><tr><td><h4>${title}</h4><div class='description'><p>{{html description}}</p></div></td><td><div>{{html image}}</div><div id='insert'></div></td></tr></table><div class='footer'><ul>{{html links}}</ul></div></div>"),filter_modal:f.template(null,"<div class='tg-modal timeglider-menu-modal timeglider-filter-box'><div class='close-button'></div><h3>filter</h3><div class='timeglider-menu-modal-content'><div class='timeglider-formline'>show: <input type='text' class='timeglider-filter-include'></div><div class='timeglider-formline'>hide: <input type='text' class='timeglider-filter-exclude'></div><ul><li class='timeglider-filter-clear'>clear</li><li class='timeglider-filter-apply'>apply</li></ul></div><div class='timeglider-menu-modal-point-right'></div>"),
timeline_list_modal:f.template(null,"<div class='timeglider-menu-modal timeglider-timeline-menu'><div class='close-button'></div><h3>timelines</h3><div class='timeglider-menu-modal-content'><ul></ul></div><div class='timeglider-menu-modal-point-right'></div>"),settings_modal:f.template(null,"<div class='timeglider-menu-modal timeglider-settings-modal'><div class='close-button'></div><h3>settings</h3><div class='timeglider-menu-modal-content'><div class='timeglider-settings-timezone'></div></div><div class='timeglider-menu-modal-point-right'></div>"),
legend_modal:f.template(null,"<div class='timeglider-menu-modal timeglider-legend timeglider-display-none'  id='${id}_legend'><div class='timeglider-menu-modal-content'><ul id='${id}'>{{html legend_list}}</ul><div class='timeglider-close-button-small timeglider-legend-close'></div><div class='timeglider-legend-all'>all</div></div></div>")};this.timelineModal=t.TG_TimelineView.extend({tagName:"div",model:t.TG_Timeline,className:"tg-modal timeglider-timeline-modal ui-widget-content",events:{"click .close-button-remove":"remove"},
template:"<div class='close-button-remove'></div><h4 id='title'>${title}</h4><p>{{html description}}</p>",initialize:function(){this.model.bind("change",this.render,this)},render:function(){f(this.el).html(f.tmpl(this.template,this.model.attributes)).attr("id",this.model.get("id")+"_timelineModal");return this},remove:function(){f(this.el).fadeOut()}});f(p).delegate(".tg-timeline-envelope .timeline-info","click",function(){var a=f(this).data("timeline_id");o.openTimelineModal(a)}).delegate(".tg-timeline-envelope .expand-collapse",
"click",function(){var a=f(this).data("timeline_id");o.expandCollapseTimeline(a)}).delegate(".tg-timeline-envelope .tg-timeline-legend-bt","click",function(){var a=f(this).data("timeline_id");o.legendModal(a)}).delegate(".close-button-remove","click",function(){f(this).parent().remove()}).delegate(".full_modal_scrim, .full_modal_close","click",function(){f(".full_modal").remove()}).delegate(".timeglider-more-plus","click",function(){q.zoom(-1)}).delegate(".timeglider-more-plus","hover",function(){f(this).data("event_id")}).delegate(".timeglider-legend-close",
"click",function(){var a=f(p+" .timeglider-legend");a.fadeOut(300,function(){a.remove()})}).delegate(".timeglider-legend-all","click",function(){f(p+" .timeglider-legend li").each(function(){f(this).removeClass("tg-legend-icon-selected")});q.setFilters({origin:"legend",icon:"all"})}).css("height",f(z).height());this.basicFontSize=E.basic_fontsize;E.show_footer==false&&f(this._views.FOOTER).css("display","none");this.dragSpeed=0;this.dimensions=q.dimensions=this.getWidgetDimensions();this.ticksHandleOffset=
this.rightside=this.leftside=this.tickNum=0;this.timeoout_id=1;this.sliderActive=false;this.ztop=1E3;this.filterBoxActivated=false;this.buildSlider();this.setupFilter();this.setPanButton(f(".timeglider-pan-right"),-30);this.setPanButton(f(".timeglider-pan-left"),30);f(this._views.TRUCK).bind("dblclick",function(a){q.registerUIEvent({name:"dblclick",event:a})}).bind("mousewheel",function(a,j){q.mouseWheelChange(-1*(j<0?Math.floor(j):Math.ceil(j)));return false});f(u).draggable({axis:"x",start:function(){o.eventUnHover()},
drag:function(){x=Math.floor(f(this).position().left);q.setTicksOffset(x);F=x-n;n=x;var a=o.dragScopeState;if(E.constrain_to_data&&q.activeTimelines.length==1){var j=f(".titleBar"),e=j.data("lef"),i=o.dimensions.container.centerx;if(a.state=="over-left"){f(u).css("left",-1*e+(i-1));o.dragScopeState={state:"okay"};o.registerDragging();return false}else if(a.state=="over-right"){a=-1*e+(i-1)-(j.width()-4);f(u).css("left",a);o.dragScopeState={state:"okay"};o.registerDragging();return false}}return true},
stop:function(){o.resetTicksHandle();o.registerDragging();o.registerTitles()}}).delegate(p+" .timeglider-timeline-event",H,function(){o.eventUnHover();var a=f(this),j=a.attr("id"),e=q.eventCollection.get(j).attributes;if(timeglider.mode!="authoring")if(e.click_callback)try{var i=e.click_callback.split("."),h=i.length;if(h==1)window[i[0]](e);else if(h==2)window[i[0]][i[1]](e);else if(h==3)window[i[0]][i[1]][i[2]](e)}catch(s){debug.log(e.click_callback+" method cannot be found")}else o.eventModal(j,
a)}).delegate(".timeglider-timeline-event","mouseover",function(){o.eventUnHover();var a=q.eventCollection.get(f(this).attr("id")).attributes;o.eventHover(f(this),a)}).delegate(".timeglider-timeline-event","mouseout",function(){q.eventCollection.get(f(this).attr("id"));o.eventUnHover()}).delegate(".timeglider-event-collapsed","hover",function(){q.eventCollection.get(f(this).attr("id"))});o.setCenterline();f.subscribe(v+".mediator.ticksOffsetChange",function(){o.tickHangies();o.registerDragging();
o.registerTitles()});f.subscribe(v+".mediator.focusToEvent",function(){});f.subscribe(v+".mediator.zoomLevelChange",function(){o.tickNum=0;o.leftside=0;var a=q.getZoomLevel();f(o._views.SLIDER).slider("value",o.invSliderVal(a));o.displayZoomLevel(a);o.castTicks("zoomLevelChange")});f.subscribe(v+".viewer.rendered",function(){});f.subscribe(v+".mediator.ticksReadySignal",function(){q.ticksReady===true&&o.freshTimelines()});f.subscribe(v+".mediator.refreshSignal",function(){o.tickNum=0;o.leftside=0;
o.castTicks("refreshSignal")});f.subscribe(v+".mediator.ticksArrayChange",function(){});f.subscribe(v+".mediator.scopeChange",function(){var a=q.getScope(),j=a.timelineBounds;a=a.focusDateSec;o.dragScopeState=a>j.last?{state:"over-right"}:a<j.first?{state:"over-left"}:{state:"okay"}});f.subscribe(v+".mediator.focusDateChange",function(){this.displayFocusDate()});f.subscribe(v+".mediator.timelineDataLoaded",function(){f(".timeglider-loading").fadeOut(500);o.buildSettingsMenu();o.buildTimelineMenu()});
f.subscribe(v+".mediator.activeTimelinesChange",function(){f(o._views.TIMELINE_MENU_UL+" li").each(function(){var a=f(this).data("timeline_id");_.indexOf(q.activeTimelines,a)!=-1?f(this).addClass("activeTimeline"):f(this).removeClass("activeTimeline")})});f.subscribe(v+".mediator.filterChange",function(){});if(f.support.touch){f("#"+g).addTouch();var b=document.getElementById(g);b.addEventListener("gesturestart",function(a){a.preventDefault();f("#output").append("<br>gesture zoom:"+q.getZoomLevel())},
false);b.addEventListener("gestureend",function(a){a.preventDefault();f("#output").append("<br>gesture end:"+q.getZoomLevel())},false);b.addEventListener("gesturechange",function(a){a.preventDefault();a.preventDefault();if(q.gesturing===false){q.gesturing=true;q.gestureStartZoom=q.getZoomLevel()}q.setZoomLevel(Math.ceil(q.gestureStartZoom/(a.scale/2)))},false)}};t.TG_PlayerView.prototype={resize:function(){var d=f(z).height();f(p).height(d);this.dimensions=this.getWidgetDimensions();q.setDimensions(this.dimensions);
this.setCenterline();q.refresh()},getWidgetDimensions:function(){var d=f(p),m=d.width(),o=Math.floor(m/2)+1,b=d.height(),a=Math.floor(b/2),j=this.tick_height,e=d.position().left;d=d.offset();var i=E.show_footer==true?f(this._views.FOOTER).height():0;return{container:{width:m,height:b,centerx:o,centery:a,left:e,offset:d},tick:{top:b-i-j},footer:{height:i}}},scaleToImportance:function(d,m){return((d-m)*4.5+100)/100},displayZoomLevel:function(){var d=q.getZoomLevel();d>0&&E.display_zoom_level==true&&
f(this._views.ZOOM_DISPLAY).text(d)},displayFocusDate:_.throttle(function(){var d=q.getFocusDate();f(w).text(d.format("d MMM yyyy",false))},300),setPanButton:function(d,m){var o=this;f(d).live("mousedown",function(){o.intervalMachine("pan",{type:"set",fn:o.pan,args:[m],intvl:33})}).live("mouseup",function(){o.intervalMachine("pan",{type:"clear",fn:o.pan,callback:"resetTicksHandle"})}).live("mouseout",function(){o.intervalMachine("pan",{type:"clear",fn:o.pan,callback:"resetTicksHandle"})})},intervalMachine:function(d,
m){var o=this;if(m.type==="clear"){clearInterval(y[d]);if(m.callback)o[m.callback]()}else y[d]=setInterval(function(){m.fn.apply(o,m.args)},m.intvl)},invSliderVal:function(d){return Math.abs(d-101)},pan:function(d){var m=d||20;d=f(u);m=d.position().left+m;d.css({left:m});q.setTicksOffset(m)},registerTitles:function(){var d,m,o,b,a,j,e,i,h,s,r=f(p).offset().left;f(p+" .timeglider-event-spanning").each(function(){var B=f(this);d=B.offset().left-r;a=B.find(".timeglider-event-title");m=a.outerWidth();
o=a.siblings(".timeglider-event-spanner").outerWidth();if(o>m)if(d<0)Math.abs(d)<o-m?a.css({marginLeft:-1*d+5}):a.css({marginLeft:o-m-5});else a.css({marginLeft:5})});f.browser.msie&&parseInt(f.browser.version);f(p+" .tg-timeline-envelope").each(function(){j=f(this);e=j.offset().left-r;i=j.find(".titleBar");b=i.data("lef");s=-1*(b+e);h=i.find(".timeline-title");if(s>0){var B=i.width()-h.width();s<B?h.css({marginLeft:s+5}):h.css({marginLeft:B-5})}else h.css({marginLeft:5})})},registerDragging:function(){var d=
q.startSec,m=f(u).position().left,o=q.getZoomInfo().spp;d=new D(d-m*o);q.setFocusDate(d);this.displayFocusDate()},setupFilter:function(){var d=this;f(d._views.FILTER_BT);var m=f.tmpl(d._templates.filter_modal,{}).appendTo(d._views.CONTAINER);m.position({my:"right bottom",at:"right top",of:f(d._views.FILTER_BT),offset:"-8, -30"}).css("z-index",d.ztop++).hide();f(p).delegate(".timeglider-filter-box .close-button","click",function(){m.fadeOut()});f(d._views.FILTER_BT).bind("click",function(){m.fadeIn();
f(this);var o=d._views.FILTER_BOX;if(d.filterBoxActivated==false){d.filterBoxActivated=true;var b=f(o+" .timeglider-filter-apply"),a=f(".timeglider-filter-box .close-button"),j=f(o+" .timeglider-filter-clear"),e="",i="";b.bind("click",function(){e=f(o+" .timeglider-filter-include").val();i=f(o+" .timeglider-filter-exclude").val();q.setFilters({origin:"clude",include:e,exclude:i});f(o).toggleClass("timeglider-display-block")});a.bind("click",function(){f(o).toggleClass("timeglider-display-none")});
j.bind("click",function(){q.setFilters({origin:"clude",include:"",exclude:""});f(o+" .timeglider-filter-include").val("");f(o+" .timeglider-filter-exclude").val("");f(o).toggleClass("timeglider-display-block")})}})},buildTimelineMenu:function(){var d=this,m;f(d._views.TIMELINE_LIST_BT);f(d._views.TIMELINE_MENU)[0]&&f(d._views.TIMELINE_MENU).remove();m=f.tmpl(d._templates.timeline_list_modal,{}).appendTo(d._views.CONTAINER);var o=Backbone.View.extend({initialize:function(){this.model.bind("change",
this.render,this)},tagName:"li",className:"timeglider-timeline-list-item",template:"${title}",events:{click:"toggleTimeline"},toggleTimeline:function(){q.toggleTimeline(this.model.get("id"))},render:function(){var b=this.model.get("id");f(this.el).html(f.tmpl(this.template,this.model.attributes)).data("timeline_id",b);return this}});f(d._views.TIMELINE_MENU_UL).html("");_.each(q.timelineCollection.models,function(b){f(d._views.TIMELINE_MENU_UL).append((new o({model:b})).render().el)});m.position({my:"right bottom",
at:"right top",of:f(d._views.TIMELINE_LIST_BT),offset:"-8, -30"}).hide();f(p).delegate(".timeglider-timeline-menu .close-button","click",function(){m.fadeOut()}).delegate(this._views.TIMELINE_LIST_BT,"click",function(){m.fadeIn()})},getTimezonePulldown:function(d,m){var o="<select name='timezone' id='"+d+"'>",b=false,a="selected";f.map(D.timezones,function(j){if(m==j.offset&&b==false){a="selected";b=true}else a="";o+="<option value='"+j.offset+"' "+a+">"+j.name+"</option>"});o+="</select>";return o},
buildSettingsMenu:function(){var d=f.tmpl(this._templates.settings_modal,{}).appendTo(this._views.CONTAINER),m=this.getTimezonePulldown("timeglider-settings-timezone",q.timeOffset.string);d.find(".timeglider-settings-timezone").append('<p>Make changes below, then click on "save". More settings options to come!</p>').append('<span class="settings-label">timezone:</span> '+m).append("<p style='clear:both'>&nbsp;</p><div class='btn success' id='timeglider-settings-save'>save</div>");d.position({my:"right bottom",
at:"right top",of:f(this._views.SETTINGS_BT),offset:"-8, -30"}).hide();f(p).delegate(".timeglider-settings-modal .close-button","click",function(){d.fadeOut()}).delegate(this._views.SETTINGS_BT,"click",function(){d.fadeIn()}).delegate("#timeglider-settings-save","click",function(){var o=f(p+" #timeglider-settings-timezone").val();q.setTimeoffset(o)})},buildSlider:function(){var d=q.getZoomLevel();if(E.min_zoom==E.max_zoom)f(this._views.SLIDER_CONTAINER).css("display","none");else{E.display_zoom_level==
true&&f("<div>").appendTo(this._views.SLIDER_CONTAINER).addClass("timeglider-zoomlevel-display").html("&nbsp;");var m=this;d=m.invSliderVal(d);var o=q.max_zoom,b=q.min_zoom;f(this._views.SLIDER).css("height",(1+o-b)*3).slider({steps:100,handle:f(".knob"),animate:300,orientation:"vertical",min:m.invSliderVal(o),max:m.invSliderVal(b),value:d,start:function(){m.sliderActive=true},stop:function(){m.sliderActive=false},change:function(){},slide:function(a,j){q.setZoomLevel(m.invSliderVal(j.value))}})}},
getEventDateLine:function(d){var m="<span class='timeglider-dateline-startdate'>"+d.startdateObj.format("",true,q.timeOffset)+"</span>",o="";if(d.span==true)o=" &ndash; <span class='timeglider-dateline-enddate'>"+d.enddateObj.format("",true,q.timeOffset)+"</span>";return m+o},eventHover:function(d,m){var o=f(".timeglider-event-hover-info");m.date_display!="no"&&o.position({my:"left bottom",at:"left top",of:d,offset:"1, -10",collision:"flip flip"}).html(this.getEventDateLine(m));d.addClass("tg-event-hovered")},
eventUnHover:function(){f(".timeglider-event-hover-info").css("left","-1000px");f(".timeglider-timeline-event").removeClass("tg-event-hovered")},clearTicks:function(){this.tickNum=this.leftside=0;f(u).css("left",0);f(p+" .tg-timeline-envelope").remove();f(p+" .timeglider-tick").remove()},castTicks:function(){this.clearTicks();q.getZoomLevel();var d=q.getFocusDate(),m=q.getZoomInfo().width;m=Math.ceil(this.dimensions.container.width/m)+4;var o="l";q.setTicksReady(false);this.addTick({type:"init",focus_date:d});
for(d=1;d<=m;d+=1){this.addTick({type:o});o=o=="l"?"r":"l"}q.setTicksReady(true);this.displayFocusDate()},getTickTop:function(){var d=typeof q.options.tick_top;return d=="number"?q.options.tick_top:d=="function"?q.options.tick_top(me.dimensions):parseInt(this.dimensions.tick.top)},addTick:function(d){var m=0,o=0,b=o=0,a=0,j=0,e=j="",i={};j={};b={};var h={};j={};var s=i="";s=q.getZoomInfo().unit;h=q.getZoomInfo().width;a=q.getFocusDate();b=this.getTickTop();a=q.addToTicksArray({type:d.type,unit:s},
a);if(s=="mo"){j=D.getMonthAdj(a,h);h=j.width;m=j.days}this.tickNum++;if(d.type=="init"){j=this.tickOffsetFromDate(q.getZoomInfo(),q.getFocusDate(),h);o=Math.ceil(this.dimensions.container.centerx+j);f(u).data("init-left",o);this.leftside=o;this.rightside=o+h}else if(d.type=="l")this.leftside=o=Math.floor(this.leftside-h);else if(d.type=="r"){o=Math.floor(this.rightside);this.rightside+=h}q.getTickBySerial(a).width=h;q.getTickBySerial(a).left=o;j=this._views.PLACE+"_"+s+"_"+a+"-"+this.tickNum;j=f("<div class='timeglider-tick "+
(a%2==0?"tg-even-tick":"tg-odd-tick")+"' id='"+j+"'><div class='timeglider-tick-label' id='label'></div></div>").appendTo(u);j.css({width:h,left:o,top:b,zIndex:0});b=this.getTickMarksInfo({unit:s,width:h});b=m||b.tperu;o=h/b;if(o>5)for(d=m=0;d<b;d++){e="&nbsp;";if(o>16)if(s=="da")e=this.getHourLabelFromHour(d,o);else if(s=="mo")e=d+1;else if(s=="ye")e=o>30?"&nbsp;"+D.monthNamesAbbr[d+1]:"&nbsp;"+D.monthNamesLet[d+1];else if(s=="de"){if(o>44)e=a+""+d}else if(s=="ce")if(o>28)e=a+""+d+"0";i+="<div class='timeglider-tick-sub-label "+
s+"' style='left:"+m+"px;width:"+o+"px'>"+e+"</div>";m+=o}i&&j.append("<div class='tg-tick-sublabel-group' style='width:"+(h+10)+"px;'>"+i+"</div>");h={unit:s,width:h,serial:a};i=this.getDateLabelForTick(h);h.seconds=this.getTickSeconds[s](h.serial);j.children("#label").text(i);return h},setCenterline:function(){q.options.show_centerline===true?f(this._views.CENTERLINE).css({height:this.dimensions.container.height,left:this.dimensions.container.centerx}):f(this._views.CENTERLINE).css({display:"none"})},
getTickSeconds:{da:function(d){d*=86400;return{start:d,end:d+86400}},mo:function(d){d*=2629800;return{start:d,end:d+2629800}},ye:function(d){d*=3154E4;return{start:d,end:d+3154E4}},de:function(d){d*=3154E5;return{start:d,end:d+3154E5}},ce:function(d){d*=3154E6;return{start:d,end:d+3154E6}},thou:function(d){d*=3154E6;return{start:d,end:d+3154E6}},tenthou:function(d){d*=3154E6;return{start:d,end:d+3154E6}},hundredthou:function(d){d*=3154E6;return{start:d,end:d+3154E6}},mill:function(d){d*=3154E6;return{start:d,
end:d+3154E6}},tenmill:function(d){d*=3154E6;return{start:d,end:d+3154E6}},hundredmill:function(d){d*=3154E6;return{start:d,end:d+3154E6}},bill:function(d){d*=3154E6;return{start:d,end:d+3154E6}}},getHourLabelFromHour:function(d,m){var o="",b=d,a="";a=0;if(m<16)return"";else{if(d>12)b=d-12;else if(d==0)b=12;if(m>30)o=d>11?" pm":" am";if(m>200){a=m/4-4;return"<div class='minutes' style='width:"+a+"px'>"+b+":00 "+o+"</div><div class='minutes' style='width:"+a+"px'>"+b+":15 "+o+"</div><div class='minutes' style='width:"+
a+"px'>"+b+":30 "+o+"</div><div class='minutes' style='width:"+a+"px'>"+b+":45 "+o+"</div>"}else return b+(m>60?":00":"")+o}},getTickMarksInfo:function(d){switch(d.unit){case "da":d=24;break;case "mo":d=30;break;case "ye":d=12;break;default:d=10}return{tperu:d}},getDateLabelForTick:function(d){var m=d.serial,o=d.width;switch(d.unit){case "bill":return m==0?"1":m>0?m+" billion":m+" b.y. bce";case "hundredmill":return m==0?"1":m>0?m+"00 million":m+"00 m.y. bce";case "tenmill":return m==0?"1":m>0?m+
"0 million":m+"0 m.y. bce";case "mill":return m==0?"1":m>0?m+" million":m+" m.y. bce";case "hundredthou":return m==0?"1":m>0?m+"00,000":m+"00,000 bce";case "tenthou":return m==0?"1":m>0?m+"0,000":m+"0,000 bce";case "thou":return m==0?"1("+m+")":m>0?m+"000":m+"000 bce";case "ce":return m==0?"1("+m+")":m>0?m+"00":m+"00 bce";case "de":return m>120?m*10+"s":m*10;case "ye":return m;case "mo":d=D.getDateFromMonthNum(m);return o<120?D.monthNamesAbbr[d.mo]+" "+d.ye:D.monthNames[d.mo]+", "+d.ye;case "da":d=
new D(D.getDateFromRD(m));return o<120?D.monthNamesAbbr[d.mo]+" "+d.da+", "+d.ye:D.monthNames[d.mo]+" "+d.da+", "+d.ye;default:return d.unit+":"+m+":"+o}},tickHangies:function(){var d=f(u).position().left,m=this.rightside+d-this.dimensions.container.width;if(this.leftside+d>-100){d=this.addTick({type:"l"});this.appendTimelines(d,"left")}else if(m<100){d=this.addTick({type:"r"});this.appendTimelines(d,"right")}},tickOffsetFromDate:function(d,m,o){switch(d.unit){case "da":m=m.ho/24+m.mi/1440;o*=m;break;
case "mo":d=D.getMonthDays(m.mo,m.ye);m=(m.da-1)/d+m.ho/(24*d)+m.mi/(1440*d);o*=m;break;case "ye":m=((m.mo-1)*30+m.da)/365;o*=m;break;case "de":m=m.ye%10/10+m.mo/120;o*=m;break;case "ce":m=m.ye%100/100+m.mo/1200;o*=m;break;case "thou":m=m.ye%1E3/1E3;o*=m;break;case "tenthou":m=m.ye%1E4/1E4;o*=m;break;case "hundredthou":m=m.ye%1E5/1E5;debug.log("hundredthou prop:",m);o*=m;debug.log("hundredthou p:",o);break;case "mill":m=m.ye%1E6/1E6;o*=m;break;case "tenmill":m=m.ye%1E7/1E7;o*=m;break;case "hundredmill":m=
m.ye%1E8/1E7;o*=m;break;case "bill":m=m.ye%1E9/1E9;o*=m;break;default:o=0}return-1*o},resetTicksHandle:function(){f(this._views.HANDLE).offset({left:f(p).offset().left})},easeOutTicks:function(){Math.abs(F)>5&&f(u).animate({left:"+="+3*F},1E3,"easeOutQuad",function(){debug.trace("stopping easing","note")})},getTimelineEventsByTick:function(d){var m=d.tick.unit,o=d.tick.serial;d=q.eventCollection.getTimelineHash(d.timeline.timeline_id);return d[m][o]&&d[m][o].length>0?d[m][o]:[]},passesFilters:function(d,
m){var o=true,b="";b="";var a=[],j;b="";a=[];if(m<d.low_threshold||m>d.high_threshold)return false;if(b=q.filters.include){a=b.split(",");o=false;for(j=0;j<a.length;j++){b=RegExp(f.trim(a[j]),"i");if(d.title.match(b)||d.description.match(b))o=true}}if(b=q.filters.exclude){a=b.split(",");for(j=0;j<a.length;j++){b=RegExp(f.trim(a[j]),"i");if(d.title.match(b)||d.description.match(b))o=false}}if(q.filters.legend.length>0){b=d.icon;if(_.indexOf(q.filters.legend,b)==-1)o=false}if(q.filters.tags.length>
0)if(d.tags){ev_tags=d.tags.split(",");_.each(ev_tags,function(e){e=f.trim(e);if(_.indexOf(q.filters.tags,e)!==-1)o=true})}else o=false;if(q.filters.custom&&typeof q.filters.custom=="function")o=q.filters.custom(d);return o},freshTimelines:function(){var d=this,m,o,b,a=q.activeTimelines,j=q.ticksArray,e="",i,h;o="";var s=d.dimensions.container.centerx,r=d.dimensions.container.width,B=q.getFocusDate().sec,c=q.getZoomInfo(),k=c.spp;c=c.unit;o=[];var l=[];r=Math.floor(k*(r/2));for(var A=B-r,C=B+r,G=
b=i=0,J=d.dimensions.container.height,K=G=0;K<a.length;K++){l=[];o=q.timelineCollection.get(a[K]);m=o.attributes;m.visibleEvents=[];r=m.display;G=m.top?parseInt(m.top.replace("px","")):J-d.initTimelineVOffset;o=new t.TG_TimelineView({model:o});i=q.timeOffset.seconds/k;h=f(o.render().el).appendTo(u);h.draggable({axis:"y",handle:".titleBar",stop:function(){var O=f(this).css("top"),N=f(this).attr("id");q.timelineCollection.get(N).set({top:O});q.refresh()}}).css({top:G,left:i});i=h.find(".titleBar");
if(typeof m.bounds!="undefined"){o=s+(m.bounds.first-B)/k;b=s+(m.bounds.last-B)/k}else{o=s;b=s+300}b=Math.floor(b-o);if(b>1E6){var I=b-1E6;b=1E6;if(o<-998E3)o+=I}i.css({top:void 0,left:o,width:b}).data({lef:o,wid:b});if(r=="expanded")m.borg=e=new timeglider.TG_Org;for(i=0;i<j.length;i++){o=this.getTimelineEventsByTick({tick:j[i],timeline:m});l=_.union(l,o)}m.visibleEvents=l;_.each(m.spans,function(O){if(_.indexOf(l,O.id)===-1)if(O.start<A&&O.end>C||O.end<C&&O.end>A){l.unshift(O.id);m.visibleEvents.push(O.id)}});
o=this.compileTickEventsAsHtml(m,_.uniq(l),0,"sweep",c);G=E.event_overflow=="scroll"?0:m.hasImagesAbove?G-d.imageLaneHeight-16:G;if(r=="expanded"){o=e.getHTML("sweep",G);m.borg=e.getBorg()}o!="undefined"&&h.append(o.html);setTimeout(function(){d.registerEventImages(h)},3)}d.registerTitles();setTimeout(function(){d.applyFilterActions()},300);f.publish("viewer.rendered")},appendTimelines:function(d,m){for(var o=q.activeTimelines,b=[],a,j="",e=this,i=0;i<o.length;i++){a=q.timelineCollection.get(o[i]).attributes;
b=this.getTimelineEventsByTick({tick:d,timeline:a});a.visibleEvents=_.union(a.visibleEvents,b);m=="left"&&_.each(a.spans,function(h){if(h.end<d.seconds.end&&h.end>d.seconds.start)if(_.indexOf(a.visibleEvents,h.id)===-1){b.unshift(h.id);a.visibleEvents.push(h.id)}});j=this.compileTickEventsAsHtml(a,b,d.serial,"append",d.unit);if(a.display=="expanded")j=a.borg.getHTML(d.serial,a.top);f(p+" .tg-timeline-envelope#"+a.id).append(j.html);this.registerEventImages(void 0)}setTimeout(function(){e.applyFilterActions()},
500);f.publish("viewer.rendered")},compileTickEventsAsHtml:function(d,m,o,b,a){var j=0,e=this.dimensions.container.centerx,i=d.display,h="",s=q.startSec,r=q.getZoomInfo(),B=r.spp;r=r.level;var c=j=0,k=d.borg,l={},A="sweep";d.borg.clearFresh();if(b=="append")A=o;for(o=0;o<m.length;o++){l=q.eventCollection.get(m[o]).attributes;if(this.passesFilters(l,r)===true){j=e+(l.startdateObj.sec*(!(a=="da"||a=="mo"||a=="ye"||a=="ce"||a=="de")?0.99795:1)-s)/B;if(i=="expanded"){b=d.size_importance===true||d.size_importance===
1?this.scaleToImportance(l.importance,r):1;l.width=l.titleWidth*b+16;l.fontsize=this.basicFontSize*b;l.left=j;l.spanwidth=0;if(l.span==true){l.spanwidth=(l.enddateObj.sec-l.startdateObj.sec)/B;if(l.spanwidth>l.width)l.width=l.spanwidth+16}b=Math.ceil(l.fontsize);l.height=b+4;l.top=0-b;if(l.image&&l.image.display_class==="inline"){b=(l.image.scale||100)/100;j=b*l.image.height+2;c=b*l.image.width+2;l.shape={img_ht:j,img_wi:c,top:l.top-j,bottom:l.top-4,left:l.left,right:l.left+c}}else l.shape=null;k.addBlock(l,
A)}else if(i=="collapsed")h+="<div id='"+l.id+"' class='timeglider-event-collapsed' style='top:-2px;left:"+j+"px'></div>"}}return i=="collapsed"?{html:h}:""},setImageLaneHeight:function(d,m){this.imageLaneHeight=d;m&&q.refresh()},registerEventImages:function(){var d=this;f(p+" .timeglider-event-image-above").each(function(){var m=d.imageLaneHeight,o=f(this),b=f(this).find("img"),a=12,j=b.data("max_height"),e=j<m?j:m;if(j<m)a+=(m-j)/2;o.css({display:"block"}).position({my:"top",at:"top",of:f(p),offset:"0, "+
a}).css({left:0});b.css("height",e)})},applyFilterActions:function(){var d=q.filterActions,m=q.eventCollection.models,o;_.isEmpty(d)||_.each(d,function(b){_.each(m,function(a){if(b.filter(a)){o=a.get("id");b.fn(f(".timeglider-timeline-event#"+o))}})})},expandCollapseTimeline:function(d){d=q.timelineCollection.get(d).attributes;d.display=d.display=="expanded"?"collapsed":"expanded";q.refresh()},openTimelineModal:function(d){d=new this.timelineModal({model:q.timelineCollection.get(d)});f(d.render().el).appendTo("body").position({my:"left top",
at:"left top",of:this._views.CONTAINER,offset:"32, 32",collision:"fit fit"}).css("z-index",this.ztop++).draggable({stack:".timeglider-modal"})},createEventLinksMenu:function(d){if(!d)return"";var m="",o=0,b="",a="";if(typeof d=="string")m="<li><a href='"+d+"' target='_blank'>link</a></li>";else if(typeof d=="object")for(o=0;o<d.length;o++){b=d[o].url;a=d[o].label;m+="<li><a href='"+b+"' target='_blank'>"+a+"</a></li>"}return m},eventModal:function(d,m){f(p+" #"+d+"_modal").remove();var o=this,b=false,
a=false,j="";j={};j=0;var e=q.eventCollection.get(d).attributes;j=e.modal_type||E.event_modal.type;var i=e.image&&e.image.src?"<img src='"+e.image.src+"'>":"",h=this.createEventLinksMenu(e.link);i={title:e.title,description:e.description,link:e.link,dateline:o.getEventDateLine(e),links:h,image:i};if(e.video){i.video=e.video;j="full";a=true;i.video=e.video}else if(e.map&&e.map.latlong){b=true;j="full"}switch(j){case "full":j=f.tmpl(o._templates.event_modal_full,i);i=32;j.appendTo(p).css({"z-index":o.ztop++}).position({my:"left top",
at:"left top",of:p,offset:"0, 0",collision:"none none"});if(b==true){j.find("#insert").append("<div id='map_modal_map'></div>");j=e.map.zoom||12;i=String(e.map.latlong).split(",");i=new google.maps.LatLng(parseFloat(i[0]),parseFloat(i[1]));j={zoom:j,center:i,mapTypeId:google.maps.MapTypeId.ROADMAP};j=new google.maps.Map(f("#map_modal_map")[0],j);if(e.map.markers)for(i=0;i<e.map.markers.length;i++){b=e.map.markers[i];new google.maps.MarkerImage(b.image,new google.maps.Size(24,32),new google.maps.Point(0,
0),new google.maps.Point(0,32));a=b.latlong.split(",");a=new google.maps.LatLng(a[0],a[1]);b=new google.maps.Marker({position:a,map:j,icon:b.icon,title:b.title,zIndex:b.zIndex})}}else a==true&&j.find("#insert").append("<iframe width='100%' height='300' src='"+e.video+"'></iframe></div>");e=o.dimensions.container.height;j=o.dimensions.container.width;i=f(p+" .full_modal_panel");b=i.width();a=i.height();i.css({top:(e-a)/2+"px",left:(j-b)/2+"px"});break;case "video":j=f.tmpl(o._templates.event_modal_video,
i);j.appendTo(u).css("z-index",o.ztop++).position({my:"right center",at:"left center",of:m,offset:"-12, -1",collision:"flip fit"}).hover(function(){f(this).css("z-index",o.ztop++)});break;case "link-iframe":debug.log("templ_obj:",i);j=f.tmpl(o._templates.event_modal_iframe,i);j.appendTo(u).css("z-index",o.ztop++).position({my:"center top",at:"center top",of:f(p),offset:"0, -12",collision:"flip fit"}).hover(function(){f(this).css("z-index",o.ztop++)});break;default:j=f.tmpl(o._templates.event_modal_small,
i).appendTo(m.parent());i=8;h=a=e="";e=m.position().left;a=m.position().top;var s=j.outerHeight();h=j.outerWidth();var r=o.dimensions.container.offset,B=m.offset();b=0;if(B.top-r.top<s+i){b=a+m.height()+8;a="top"}else{b=a-(s+12);a="bottom"}r=B.left-r.left;h=o.dimensions.container.width-(h+i);if(r<i){e+=Math.abs(r)+i;h="left"}else if(r>h){e-=r-h;h="right"}else h="left";debug.log("arrow class:","arrow-"+a+"-"+h);j.css({"z-index":o.ztop++,top:b,left:e})}},legendModal:function(d){var m=q.timelineCollection.get(d).attributes.legend,
o=0,b="",a="",j="";o="";for(o=0;o<m.length;o++){b=E.icon_folder+m[o].icon;a=m[o].title;j+="<li><img class='legend-icon' src='"+b+"'><span class='legend-info'>"+a+"</span></li>"}d={id:d,legend_list:j};f(p+" .timeglider-legend").remove();f.tmpl(this._templates.legend_modal,d).appendTo(p).css("z-index",this.ztop++).toggleClass("timeglider-display-none").position({my:"left top",at:"left top",of:p,offset:"16, -4",collision:"none none"});o=p+" .legend-info, "+p+" .legend-icon";f(o).bind("mouseup",function(e){e=
f(e.target).parent().children("img").attr("src");f(this).parent().toggleClass("tg-legend-icon-selected");q.setFilters({origin:"legend",icon:e})})},parseHTMLTable:function(d){var m={},o=+new Date,b=[];f("#"+d).find("tr").each(function(a){var j=f(this).children(),e;if(a===0)b=j.map(function(){return f(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{e={};j.each(function(i){e[b[i]]=f(this).text()});m["prefix"+o++]=e}});return m}};t.TG_TimelineView=Backbone.View.extend({initialize:function(){var d=
this;this.model.bind("change:title",function(){f(d.el).find(".timeline-title-span").text(d.model.get("title"))});this.model.bind("destroy",this.remove,this)},tagName:"div",events:{"click .timeline-title-span":"titleClick"},className:"tg-timeline-envelope",getTemplate:function(){var d="<div class='titleBar'><div class='timeline-title'><span class='timeline-title-span'>${title}</span><div class='tg-timeline-env-buttons'>";if(this.model.get("description"))d+="<span class='timeline-info' data-timeline_id='${id}'>info</span>";
if(this.model.get("hasLegend"))d+="<span class='tg-timeline-legend-bt' data-timeline_id='${id}'>legend</span>";d+="<span class='expand-collapse' data-timeline_id='${id}'>exp/col</span>";d+="</div></div></div>";return d},render:function(){this.model.get("id");this.model.get("title");var d=this.getTemplate();f(this.el).html(f.tmpl(d,this.model.attributes)).attr("id",this.model.get("id"));return this},setText:function(){},titleClick:function(){q.timelineTitleClick(this.model.get("id"))},remove:function(){f(this.el).remove()}});
t.zoomTree=[{},{unit:"da",width:35E3,level:1,label:"5 hours"},{unit:"da",width:17600,level:2,label:"7 hours"},{unit:"da",width:8800,level:3,label:"10 hours"},{unit:"da",width:4400,level:4,label:"12 hours"},{unit:"da",width:2200,level:5,label:"14 hours"},{unit:"da",width:1100,level:6,label:"17 hours"},{unit:"da",width:550,level:7,label:"22 hours"},{unit:"da",width:432,level:8,label:"1 DAY"},{unit:"da",width:343,level:9,label:"1.5 days"},{unit:"da",width:272,level:10,label:"2 days"},{unit:"da",width:216,
level:11,label:"2.5 days"},{unit:"da",width:171,level:12,label:"3 days"},{unit:"da",width:136,level:13,label:"3.5 days"},{unit:"da",width:108,level:14,label:"4 days"},{unit:"mo",width:2509,level:15,label:"6 days"},{unit:"mo",width:1945,level:16,label:"1 WEEK"},{unit:"mo",width:1508,level:17,label:"10 days"},{unit:"mo",width:1169,level:18,label:"2 weeks"},{unit:"mo",width:913,level:19,label:"2.5 weeks"},{unit:"mo",width:719,level:20,label:"3 weeks"},{unit:"mo",width:566,level:21,label:"3.5 weeks"},
{unit:"mo",width:453,level:22,label:"1 MONTH"},{unit:"mo",width:362,level:23,label:"5.5 weeks"},{unit:"mo",width:290,level:24,label:"7 weeks"},{unit:"mo",width:232,level:25,label:"2 months"},{unit:"mo",width:186,level:26,label:"2.5 months"},{unit:"mo",width:148,level:27,label:"3 months"},{unit:"mo",width:119,level:28,label:"4 months"},{unit:"mo",width:95,level:29,label:"5 months"},{unit:"mo",width:76,level:30,label:"6 months"},{unit:"ye",width:723,level:31,label:"9 months"},{unit:"ye",width:573,level:32,
label:"1 YEAR"},{unit:"ye",width:455,level:33,label:"1.25 years"},{unit:"ye",width:361,level:34,label:"1.5 years"},{unit:"ye",width:286,level:35,label:"2 years"},{unit:"ye",width:227,level:36,label:"2.5 years"},{unit:"ye",width:179,level:37,label:"3 years"},{unit:"ye",width:142,level:38,label:"4 years"},{unit:"ye",width:113,level:39,label:"5 years"},{unit:"ye",width:89,level:40,label:"6 years"},{unit:"de",width:705,level:41,label:"8 years"},{unit:"de",width:559,level:42,label:"10 years"},{unit:"de",
width:443,level:43,label:"13 years"},{unit:"de",width:302,level:44,label:"16 years"},{unit:"de",width:240,level:45,label:"20 years"},{unit:"de",width:190,level:46,label:"25 years"},{unit:"de",width:150,level:47,label:"30 years"},{unit:"de",width:120,level:48,label:"40 years"},{unit:"de",width:95,level:49,label:"50 years"},{unit:"de",width:76,level:50,label:"65 years"},{unit:"ce",width:600,level:51,label:"80 years"},{unit:"ce",width:480,level:52,label:"100 years"},{unit:"ce",width:381,level:53,label:"130 years"},
{unit:"ce",width:302,level:54,label:"160 years"},{unit:"ce",width:240,level:55,label:"200 years"},{unit:"ce",width:190,level:56,label:"250 years"},{unit:"ce",width:150,level:57,label:"300 years"},{unit:"ce",width:120,level:58,label:"400 years"},{unit:"ce",width:95,level:59,label:"500 years"},{unit:"ce",width:76,level:60,label:"600 years"},{unit:"thou",width:603,level:61,label:"1000 years"},{unit:"thou",width:478,level:62,label:"1200 years"},{unit:"thou",width:379,level:63,label:"1800 years"},{unit:"thou",
width:301,level:64,label:"160 years"},{unit:"thou",width:239,level:65,label:"xxx years"},{unit:"thou",width:190,level:66,label:"xxx years"},{unit:"thou",width:150,level:67,label:"xxx years"},{unit:"thou",width:120,level:68,label:"xxx years"},{unit:"thou",width:95,level:69,label:"8,000 years"},{unit:"thou",width:76,level:70,label:"10,000 years"},{unit:"tenthou",width:603,level:71,label:"15,000 years"},{unit:"tenthou",width:358,level:72,label:"20,000 years"},{unit:"tenthou",width:213,level:73,label:"30,000 years"},
{unit:"tenthou",width:126,level:74,label:"60,000 years"},{unit:"tenthou",width:76,level:75,label:"100,000 years"},{unit:"hundredthou",width:603,level:76,label:"180,000 years"},{unit:"hundredthou",width:358,level:77,label:"300,000 years"},{unit:"hundredthou",width:213,level:78,label:"500,000 years"},{unit:"hundredthou",width:126,level:79,label:"800,000 years"},{unit:"hundredthou",width:76,level:80,label:"1 million years"},{unit:"mill",width:603,level:81,label:"1.2 million years"},{unit:"mill",width:358,
level:82,label:"2 million years"},{unit:"mill",width:213,level:83,label:"3 million years"},{unit:"mill",width:126,level:84,label:"5 million years"},{unit:"mill",width:76,level:85,label:"10 million years"},{unit:"tenmill",width:603,level:86,label:"15 million years"},{unit:"tenmill",width:358,level:87,label:"30 million years"},{unit:"tenmill",width:213,level:88,label:"50 million years"},{unit:"tenmill",width:126,level:89,label:"80 million years"},{unit:"tenmill",width:76,level:90,label:"100 million years"},
{unit:"hundredmill",width:603,level:91,label:"120 million years"},{unit:"hundredmill",width:358,level:92,label:"200 million years"},{unit:"hundredmill",width:213,level:93,label:"300 million years"},{unit:"hundredmill",width:126,level:94,label:"500 million years"},{unit:"hundredmill",width:76,level:95,label:"1 billion years"},{unit:"bill",width:603,level:96,label:"15 million years"},{unit:"bill",width:358,level:97,label:"30 million years"},{unit:"bill",width:213,level:98,label:"50 million years"},
{unit:"bill",width:126,level:99,label:"80 million years"},{unit:"bill",width:76,level:100,label:"100 billion years"}];t.calculateSecPerPx=function(d){for(var m=1;m<d.length;m++){var o=d[m],b=0;switch(o.unit){case "da":b=86400;break;case "mo":b=2419200;break;case "ye":b=31536E3;break;case "de":b=31536E4;break;case "ce":b=31536E5;break;case "thou":b=31536E6;break;case "tenthou":b=31536E7;break;case "hundredthou":b=31536E8;break;case "mill":b=31536E9;break;case "tenmill":b=31536E10;break;case "hundredmill":b=
31536E11;break;case "bill":b=31536E12}o.spp=Math.round(b/parseInt(o.width))}}(t.zoomTree);t.getStringWidth=function(d){if(d)return f("#timeglider-measure-span").html(d).width()};String.prototype.removeWhitespace=function(){return this.replace(RegExp("\\n","g"),"")};if(debug)debug.trace=function(d,m){f("#"+m).text(d)};t.googleMapsInit=function(){};t.googleMapsLoaded=false;t.googleMapsLoad=function(){if(t.googleMapsLoaded==false){var d=document.createElement("script");d.type="text/javascript";d.src=
"http://maps.googleapis.com/maps/api/js?sensor=false&callback=timeglider.googleMapsInit";document.body.appendChild(d);t.googleMapsLoaded=true}}})(timeglider);(function(t){var D={},z=t.TG_Date,q={},E=jQuery,F={},x="";t.TG_Mediator=function(n,v){this.options=q=n;F=v;x=n.base_namespace+"#"+F.attr("id");this._focusDate={};this._zoomInfo={};this._zoomLevel=1;this.ticksReady=false;this.ticksArray=[];this.startSec=0;this.activeTimelines=[];this.max_zoom=q.max_zoom;this.min_zoom=q.min_zoom;this.icon_folder=t.icon_folder=q.icon_folder||"js/timeglider/icons/";this.timeOffset=z.getTimeOffset(q.timezone);this.fixed_zoom=this.max_zoom==this.min_zoom?true:false;this.gesturing=
false;this.gestureStartScale=this.gestureStartZoom=0;this.filters={include:"",exclude:"",legend:[],tags:[]};this.filterActions={};this.loadedSources=[];this.timelineCollection=new t.TG_TimelineCollection;this.eventCollection=new t.TG_EventCollection;this.imagesToSize=this.imagesSized=0;this.timelineDataLoaded=false;this.initial_timeline_id=q.initial_timeline_id||"";this.sole_timeline_id="";this.dimensions={};this.focusedEvent="";if(q.max_zoom===q.min_zoom)this.fixed_zoom=q.min_zoom;if(q.main_map){this.main_map=
q.main_map;timeglider.mapping.setMap(this.main_map,this)}D=this};t.TG_Mediator.prototype={focusToEvent:function(n){this.focusedEvent=n;this.gotoDateZoom(n.startdateObj.dateStr,n.importance);E.publish(x+".mediator.focusToEvent")},filterBy:function(n,v){var f={origin:n};f[n]=v;debug.log("fObj:",f);this.setFilters(f)},gotoDateZoom:function(n,v){var f=false;this.setFocusDate(new z(n));if(v)f=this.setZoomLevel(v);if(!v||f==false)this.refresh();E.publish(x+".mediator.scopeChange")},zoom:function(n){this.setZoomLevel(this.getZoomLevel()+
parseInt(n))},getScope:function(){var n=this.getZoomInfo(),v=this.getFocusDate(),f=this.getActiveTimelinesBounds();v=Math.round(v.sec);var y=t.TG_Date.TGSecToUnixSec(v),g=this.dimensions.container.width,p=g/2;n=Math.round(n.spp);return{spp:n,width:g,focusDateSec:v,timelines:this.activeTimelines,timelineBounds:f,container:F,leftMS:(y-p*n)*1E3,rightMS:(y+p*n)*1E3,focusMS:y*1E3}},fitToContainer:function(){var n=this.getActiveTimelinesBounds(),v=n.last-n.first;n=(n.first+n.last)/2;var f=this.dimensions.container.width,
y=_.find(t.zoomTree,function(g){return v/g.spp<f});this.gotoDateZoom(n,y.level)},addFilterAction:function(n,v,f){this.filterActions[n]={filter:v,fn:f};this.refresh()},removeFilterAction:function(n){delete this.filterActions[n];this.refresh()},getEventByID:function(n,v){var f=this.eventCollection.get(n).attributes;return v&&f.hasOwnProperty(v)?f[v]:f},adjustNowEvents:function(){var n=false,v="",f="";_.each(this.eventCollection.models,function(y){if(y.get("keepCurrent")){v=y.get("keepCurrent");f=y.get("date_display");
if(v=="start")y.set({startdateObj:new z("today",f)});else v=="end"&&y.set({enddateObj:new z("today",f)});y.reIndex();n=true}});n&&this.refresh()},addEvent:function(n){n.startdateObj=new t.TG_Date(n.startdate);n.enddateObj=new t.TG_Date(n.enddate||n.startdate);n.mediator=this;n.cache={timelines:n.timelines,startdateObj:n.startdateObj,enddateObj:n.enddateObj,span:true};n=new t.TG_Event(n);this.eventCollection.add(n);n.reIndex();this.refresh();E.publish(x+".mediator.addEvent");return n},updateEvent:function(n){if(!n.id){alert("error: you need a valid id set on the object in updateEvent()");
return false}var v=this.eventCollection.get(n.id);v.set(n);if(n.startdateObject||n.enddateObject)v.reIndex();this.refresh();E.publish(x+".mediator.updateEvent");return v},getActiveTimelinesBounds:function(){for(var n=this.activeTimelines,v={},f=99999999999,y=0,g=0;g<n.length;g++){v=this.timelineCollection.get(n[g]);f=v.get("bounds").first<f?v.get("bounds").first:f;y=v.get("bounds").last>y?v.get("bounds").last:y}return{first:f,last:y}},loadTimelineData:function(n,v){var f=this;if(n){if(_.indexOf(f.loadedSources,
n)==-1){if(typeof n==="object")f.parseTimelineData(n);else if(n.substr(0,1)=="#"){var y=[f.getTableTimelineData(n)];f.parseTimelineData(y)}else E.getJSON(n,function(g){f.parseTimelineData(g,v)});f.loadedSources.push(n)}}else{this.timelineDataLoaded=true;this.setZoomLevel(Math.floor((this.max_zoom+this.min_zoom)/2));this.tryLoading()}},mapMarkerClick:function(n){this.focusToEvent(n)},getTimelineCollection:function(){return this.timelineCollection},timelineTitleClick:function(n){E.publish(x+".mediator.timelineTitleClick",
{timeline_id:n})},getTableTimelineData:function(n){var v={},f=0,y=[],g,p,u="",w=E(n);v.id=n.substr(1);v.title=w.attr("title")||"untitled";v.description=w.attr("description")||"";v.focus_date=w.attr("focus_date")||z.getToday();v.initial_zoom=w.attr("initial_zoom")||20;v.events=[];w.find("tr").each(function(H){var d=E(this).children(),m;if(H===0)y=d.map(function(){return E(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{m={};d.each(function(o){g=y[o];p=g=="description"?E(this).html():
E(this).text();m[g]=p});u="ev_"+f++;m.id=u;v.events.push(m)}});w.css("display","none");return v},runLoadedTimelineCallback:function(n,v){n.fn(n.args||"",v);if(n.display){debug.log("callback DISPLAY true...");this.showSingleTimeline(v[0].id)}else if(n.toggle){debug.log("callback TOGGLE true...");this.toggleTimeline(v[0].id)}},parseTimelineData:function(n,v){var f=this,y=0,g=n.length,p={};p={};for(var u=0;u<g;u++){p=n[u];p.mediator=f;p=(new t.TG_Timeline(p)).toJSON();if(p.id.length>0){y++;f.swallowTimeline(p)}}if(v&&
(typeof v.fn=="function"||typeof v=="function")){if(typeof v=="function")v={fn:v};E.publish(x+".mediator.timelineDataLoaded");setTimeout(function(){f.runLoadedTimelineCallback(v,n)},100);if(v.display||v.toggle)return false}if(y===0)alert("ERROR loading data: Check JSON with jsonLint");else{this.timelineDataLoaded=true;this.tryLoading()}},tryLoading:function(){var n=this.timelineDataLoaded==true;if(this.imagesSized==this.imagesToSize&&n){this.setInitialTimelines();E.publish(x+".mediator.timelineDataLoaded")}},
swallowTimeline:function(n){this.sole_timeline_id=n.id;this.timelineCollection.add(n);E.publish(x+".mediator.timelineListChangeSignal")},setInitialTimelines:function(){debug.log("!! setInitialTimelines ??");var n=this,v=this.initial_timeline_id,f="";if(typeof v=="object"){f=this.initial_timeline_id[0];_.each(v,function(y){n.activeTimelines.push(y)})}else if(v.length>0){f=this.initial_timeline_id||this.sole_timeline_id;n.activeTimelines=[f]}else if(this.timelineCollection.length>0){f=this.timelineCollection.pluck("id")[0];
n.activeTimelines=[f]}if(timeglider.mode=="authoring")n.setZoomLevel(40);else f?setTimeout(function(){var y=n.timelineCollection.get(f),g=y.get("focusDateObj");n.setFocusDate(g);n.setZoomLevel(y.get("initial_zoom"))},500):n.setZoomLevel(40)},refresh:function(){E.publish(x+".mediator.refreshSignal")},setTicksReady:function(n){this.ticksReady=n;this.startSec=this._focusDate.sec;n===true&&E.publish(x+".mediator.ticksReadySignal")},setTimeoffset:function(n){this.timeOffset=z.getTimeOffset(n);this.refresh()},
getTimeoffset:function(){return this.timeOffset},setDimensions:function(n){this.dimensions=n},setFocusDate:function(n){if(n!=this._focusDate)this._focusDate=n},getFocusDate:function(){return this._focusDate},getZoomLevel:function(){return parseInt(this._zoomLevel)},mouseWheelChange:function(n){this.setZoomLevel(this.getZoomLevel()+n);E.publish(x+".mediator.mouseWheelChange")},setZoomLevel:function(n){if(n<=this.max_zoom&&n>=this.min_zoom){this.startSec=this._focusDate.sec;if(n!=this._zoomLevel){this._zoomLevel=
n;this._zoomInfo=t.zoomTree[n];E.publish(x+".mediator.zoomLevelChange");E.publish(x+".mediator.scopeChange");return true}else return false}else return false},getZoomInfo:function(){return this._zoomInfo},getDateFromOffset:function(n){var v=this.dimensions.container;n=n-v.offset.left-v.width/2;v=this.getZoomInfo().spp;var f=this.getFocusDate().sec;return new z(Math.floor(f+n*v))},registerUIEvent:function(n){switch(n.name){case "dblclick":n=this.getDateFromOffset(n.event.pageX);E.publish(x+".mediator.dblclick",
{date:n})}},setFilters:function(n){switch(n.origin){case "clude":this.filters.include=n.include;this.filters.exclude=n.exclude;break;case "tags":this.filters.tags=n.tags?n.tags.split(","):[];break;case "legend":var v=n.icon.replace(this.options.icon_folder,"");if(v=="all"){this.filters.legend=[];E.publish(x+".mediator.legendAll")}else if(_.indexOf(this.filters.legend,v)==-1)this.filters.legend.push(v);else{n=[];n=E.grep(this.filters.legend,function(f){return f!=v});this.filters.legend=n}break;case "custom":if(n.action==
"add"){this.filters.custom=n.fn;debug.log("this.filters.custom:",this.filters.custom)}else delete this.filters.custom}E.publish(x+".mediator.filtersChange");this.refresh()},getTicksOffset:function(){return this._ticksOffset},setTicksOffset:function(n){this._ticksOffset=n;E.publish(x+".mediator.ticksOffsetChange");E.publish(x+".mediator.scopeChange")},getTickBySerial:function(n){for(var v=this.ticksArray,f=v.length,y=0;y<f;y++){var g=v[y];if(g.serial==n)return g}return false},addToTicksArray:function(n,
v){if(n.type=="init"){n.serial=z.getTimeUnitSerial(v,n.unit);this.ticksArray=[n]}else if(n.type=="l"){n.serial=this.ticksArray[0].serial-1;this.ticksArray.unshift(n)}else{n.serial=this.ticksArray[this.ticksArray.length-1].serial+1;this.ticksArray.push(n)}E.publish(x+".mediator.ticksArrayChange");return n.serial},showSingleTimeline:function(n){this.activeTimelines=[];this.toggleTimeline(n);debug.log("clear active timelines, ought to be just the single showing timeline ",this.activeTimelines)},toggleTimeline:function(n){var v=
this.timelineCollection.get(n).attributes;debug.log("uh, is this..",n+" in "+this.activeTimelines+"?");var f=_.indexOf(this.activeTimelines,n);debug.log("is it active??",f);if(f==-1){this.activeTimelines.push(n);this.setFocusDate(new z(v.focus_date));this.setZoomLevel(v.initial_zoom)}else this.activeTimelines.splice(f,1);this.refresh();E.publish(x+".mediator.activeTimelinesChange")},reportImageSize:function(n){var v=D.eventCollection.get(n.id);if(v.has("image")){if(n.error){v.attributes.image={};
debug.log("WHOOPS: MISSING IMAGE: "+n.src)}else{v.attributes.image.width=n.width;v.attributes.image.height=n.height}this.imagesSized++;this.imagesSized==this.imagesToSize&&this.tryLoading()}}};t.getLowHigh=function(n){n=_.sortBy(n,function(v){return parseInt(v)});return{low:_.first(n),high:_.last(n)}};t.validateOptions=function(n){this.optionsMaster={initial_focus:{type:"date"},timezone:{type:"timezone"},editor:{type:"string"},backgroundColor:{type:"color"},backgroundImage:{type:"color"},min_zoom:{type:"number",
min:1,max:100},max_zoom:{type:"number",min:1,max:100},initial_zoom:{type:"number",min:1,max:100},show_centerline:{type:"boolean"},display_zoom_level:{type:"boolean"},data_source:{type:"url"},basic_fontsize:{type:"number",min:9,max:100},mouse_wheel:{type:"string",possible:["zoom","pan"]},initial_timeline_id:{type:"mixed"},icon_folder:{type:"string"},show_footer:{type:"boolean"},display_zoom_level:{type:"boolean"},constrain_to_data:{type:"boolean"},boost:{type:"number",min:0,max:99},event_modal:{type:"object"},
event_overflow:{type:"string"}};var v=this,f="";E.each(n,function(y,g){if(v.optionsMaster[y])switch(v.optionsMaster[y].type){case "string":if(typeof g!="string")f+=y+" needs to be a string.\n";if(v.optionsMaster[y].possible)if(_.indexOf(v.optionsMaster[y].possible,g)==-1)f+=y+" must be: "+v.optionsMaster[y].possible.join(" or ");break;case "number":if(typeof g!="number")f+=g+" needs to be a number.\n";if(v.optionsMaster[y].min)if(g<v.optionsMaster[y].min)f+=y+" must be greater than or equal to "+
v.optionsMaster[y].min+"\n";if(v.optionsMaster[y].max)if(g>v.optionsMaster[y].max)f+=y+" must be less than or equal to "+v.optionsMaster[y].max+"\n";break;case "timezone":var p=/[+|-]?[0-9]+:[0-9]+/;if(_.indexOf(["New York","Denver","Chicago","Los Angeles"],g)==-1&&g.match(p)==-1)f+="The timezone is not formatted properly";break;case "boolean":if(typeof g!="boolean")f+=g+" needs to be a number.\n"}});return f}})(timeglider);(function(t){var D,z,q=timeglider,E=timeglider.TG_Date;t.widget("timeglider.timeline",{options:{base_namespace:"tg",timezone:"00:00",initial_focus:q.TG_Date.getToday(),editor:"none",min_zoom:1,max_zoom:100,show_centerline:true,data_source:"",culture:"en",basic_fontsize:12,mouse_wheel:"zoom",initial_timeline_id:"",icon_folder:"js/timeglider/icons/",image_lane_height:32,show_footer:true,display_zoom_level:true,constrain_to_data:false,boost:0,event_modal:{href:"",type:"default"},event_overflow:"plus"},
_create:function(){this._id=t(this.element).attr("id");this.element.html("<div class='timeglider-container'><div class='timeglider-loading'>loading</div><div class='timeglider-centerline'></div><div class='timeglider-date-display'></div><div class='timeglider-truck' id='tg-truck'><div class='timeglider-ticks'><div class='timeglider-handle'></div></div></div><div class='timeglider-slider-container'><div class='timeglider-slider'></div><div class='timeglider-pan-buttons'><div class='timeglider-pan-left'></div><div class='timeglider-pan-right'></div></div></div><div class='timeglider-footer'><div class='timeglider-logo'></div><div class='timeglider-footer-button timeglider-filter-bt'></div><div class='timeglider-footer-button timeglider-settings-bt'></div><div class='timeglider-footer-button timeglider-list-bt'></div></div><div class='timeglider-event-hover-info'></div></div><span id='timeglider-measure-span'></span>")},
_init:function(){var F=timeglider.validateOptions(this.options);if(F==""){q.TG_Date.setCulture(this.options.culture);z=new q.TG_Mediator(this.options,this.element);D=new q.TG_PlayerView(this,z);z.setFocusDate(new E(this.options.initial_focus));z.loadTimelineData(this.options.data_source,this.options.loaded)}else alert("Rats. There's a problem with your widget settings:"+F)},goTo:function(F,x){z.gotoDateZoom(F,x);return this},refresh:function(){z.refresh();return this},resize:function(){D.resize();
return this},filterBy:function(F,x){z.filterBy(F,x);return this},addFilterAction:function(F,x,n){z.addFilterAction(F,x,n);return this},removeFilterAction:function(F){z.removeFilterAction(F);return this},getMediator:function(){return z},getEventByID:function(F,x){return z.getEventByID(F,x)},updateEvent:function(F){return z.updateEvent(F)},focusToEvent:function(F){F=z.getEventByID(F);z.focusToEvent(F);return this},getScope:function(){return z.getScope()},fitToContainer:function(){z.fitToContainer();
return this},adjustNowEvents:function(){return z.adjustNowEvents()},addEvent:function(F){return z.addEvent(F)},zoom:function(F){switch(F){case "in":F=-1;break;case "out":F=1}if(F>99||F<-99)return false;z.zoom(F);return this},loadTimeline:function(F,x){z.loadTimelineData(F,x);return this},panButton:function(F,x){var n=0;switch(x){case "left":n=30;break;case "right":n=-30;break;default:n=x}D.setPanButton(F,n)},destroy:function(){t.Widget.prototype.destroy.apply(this,arguments);t(this.element).html("")}})})(jQuery);
